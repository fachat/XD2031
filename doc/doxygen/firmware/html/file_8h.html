<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>XD2031 firmware: file.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XD2031 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">file.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cmd_8h_source.html">cmd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bus_8h_source.html">bus.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for file.h:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h__incl.png" border="0" usemap="#file_8h" alt=""/></div>
<map name="file_8h" id="file_8h">
<area shape="rect" id="node5" href="cmd_8h.html" title="cmd.h" alt="" coords="110,161,167,189"/><area shape="rect" id="node19" href="channel_8h.html" title="channel.h" alt="" coords="291,83,369,111"/><area shape="rect" id="node42" href="bus_8h.html" title="bus.h" alt="" coords="177,83,231,111"/><area shape="rect" id="node8" href="errormsg_8h.html" title="errormsg.h" alt="" coords="144,238,229,266"/><area shape="rect" id="node15" href="rtconfig_8h.html" title="rtconfig.h" alt="" coords="254,238,329,266"/><area shape="rect" id="node13" href="errors_8h.html" title="errors.h" alt="" coords="240,393,307,421"/><area shape="rect" id="node23" href="packet_8h.html" title="packet.h" alt="" coords="409,238,480,266"/><area shape="rect" id="node37" href="provider_8h.html" title="provider.h" alt="" coords="328,161,407,189"/><area shape="rect" id="node27" href="wireformat_8h.html" title="wireformat.h" alt="" coords="413,315,507,343"/><area shape="rect" id="node30" href="delay_8h.html" title="delay.h" alt="" coords="531,315,593,343"/><area shape="rect" id="node32" href="delayhw_8h.html" title="delayhw.h" alt="" coords="426,393,507,421"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h__dep__incl.png" border="0" usemap="#file_8hdep" alt=""/></div>
<map name="file_8hdep" id="file_8hdep">
<area shape="rect" id="node3" href="bus_8c.html" title="bus.c" alt="" coords="4,83,56,111"/><area shape="rect" id="node5" href="cmd_8c.html" title="cmd.c" alt="" coords="81,83,137,111"/><area shape="rect" id="node7" href="file_8c.html" title="file.c" alt="" coords="162,83,211,111"/><area shape="rect" id="node9" href="main_8c.html" title="main.c" alt="" coords="235,83,295,111"/></map>
</div>
</div>
<p><a href="file_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a986f2900e7344f4fa185c9ec97ff0d91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a986f2900e7344f4fa185c9ec97ff0d91">file_init</a> (void)</td></tr>
<tr class="separator:a986f2900e7344f4fa185c9ec97ff0d91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dac9b9090b14532b84f96929c3cb2cc"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a2dac9b9090b14532b84f96929c3cb2cc">file_open</a> (uint8_t channel_no, <a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>, <a class="el" href="structerrormsg__t.html">errormsg_t</a> *errormsg, void(*<a class="el" href="serial_8c.html#ac7063263faf9c3950f983dea0effb3bf">callback</a>)(int8_t errnum, uint8_t *rxdata), uint8_t is_save)</td></tr>
<tr class="separator:a2dac9b9090b14532b84f96929c3cb2cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8336bd2f1ed40fc3520412402061d43b"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a8336bd2f1ed40fc3520412402061d43b">file_submit_call</a> (uint8_t channel_no, uint8_t type, <a class="el" href="structerrormsg__t.html">errormsg_t</a> *errormsg, <a class="el" href="structrtconfig__t.html">rtconfig_t</a> *rtconf, void(*<a class="el" href="serial_8c.html#ac7063263faf9c3950f983dea0effb3bf">callback</a>)(int8_t errnum, uint8_t *rxdata))</td></tr>
<tr class="separator:a8336bd2f1ed40fc3520412402061d43b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a986f2900e7344f4fa185c9ec97ff0d91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void file_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="file_8c_source.html#l00054">54</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00045">open_t::channel_no</a>, and <a class="el" href="file_8c_source.html#l00039">MAX_ACTIVE_OPEN</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00082">main()</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="file_8c.html#a30d87a09ef110b7f895835b50f40114e">MAX_ACTIVE_OPEN</a>; i++) {</div>
<div class="line">        <a class="code" href="file_8c.html#a36781be560f0c4f1d4bae71e363e0650">active</a>[i].<a class="code" href="structopen__t.html#ad5e3813af7610093f319c97eeb342464">channel_no</a> = -1;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h_a986f2900e7344f4fa185c9ec97ff0d91_icgraph.png" border="0" usemap="#file_8h_a986f2900e7344f4fa185c9ec97ff0d91_icgraph" alt=""/></div>
<map name="file_8h_a986f2900e7344f4fa185c9ec97ff0d91_icgraph" id="file_8h_a986f2900e7344f4fa185c9ec97ff0d91_icgraph">
<area shape="rect" id="node3" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="118,5,168,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2dac9b9090b14532b84f96929c3cb2cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t file_open </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>channel_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structerrormsg__t.html">errormsg_t</a> *&#160;</td>
          <td class="paramname"><em>errormsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(int8_t errnum, uint8_t *rxdata)&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>is_save</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="file_8c_source.html#l00069">69</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="name_8h_source.html#l00037">nameinfo_t::access</a>, <a class="el" href="assert_8h_source.html#l00030">assert_not_null</a>, <a class="el" href="serial_8c_source.html#l00119">callback</a>, <a class="el" href="name_8h_source.html#l00035">nameinfo_t::cmd</a>, <a class="el" href="cmd_8h_source.html#l00042">CMD_DIR</a>, <a class="el" href="cmd_8h_source.html#l00040">CMD_NONE</a>, <a class="el" href="bus_8h_source.html#l00055">bus_t::command</a>, <a class="el" href="cmd_8h_source.html#l00077">cmd_t::command_buffer</a>, <a class="el" href="cmd_8c_source.html#l00076">command_to_name()</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="debug_8h_source.html#l00038">debug_putc()</a>, <a class="el" href="debug_8h_source.html#l00039">debug_putcrlf()</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="errors_8h_source.html#l00058">ERROR_FILE_EXISTS</a>, <a class="el" href="errors_8h_source.html#l00059">ERROR_FILE_TYPE_MISMATCH</a>, <a class="el" href="errors_8h_source.html#l00045">ERROR_SYNTAX_UNKNOWN</a>, <a class="el" href="file_8c_source.html#l00126">file_submit_call()</a>, <a class="el" href="wireformat_8h_source.html#l00054">FS_OPEN_AP</a>, <a class="el" href="wireformat_8h_source.html#l00055">FS_OPEN_DR</a>, <a class="el" href="wireformat_8h_source.html#l00050">FS_OPEN_RD</a>, <a class="el" href="wireformat_8h_source.html#l00051">FS_OPEN_WR</a>, <a class="el" href="name_8c_source.html#l00047">nameinfo</a>, <a class="el" href="name_8c_source.html#l00058">parse_filename()</a>, <a class="el" href="bus_8h_source.html#l00059">bus_t::rtconf</a>, <a class="el" href="errormsg_8h_source.html#l00052">set_error()</a>, and <a class="el" href="name_8h_source.html#l00036">nameinfo_t::type</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00132">cmd_handler()</a>.</p>
<div class="fragment"><div class="line">                                                                               {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="assert_8h.html#a4aac76133d59f061a6a1c3655ad0293a">assert_not_null</a>(bus, <span class="stringliteral">&quot;file_open: bus is null&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structcmd__t.html">cmd_t</a> *command = &amp;(bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>);</div>
<div class="line">    <a class="code" href="structrtconfig__t.html">rtconfig_t</a> *rtconf = &amp;(bus-&gt;<a class="code" href="structbus__t.html#ac294eee916103f1c1f9700b1d39e1f90">rtconf</a>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_FILE</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;OPEN FILE: FOR CHAN: %d WITH NAME: %s\n&quot;</span>,</div>
<div class="line">        channel_no, (<span class="keywordtype">char</span>*)&amp;(command-&gt;<a class="code" href="structcmd__t.html#a34c46fd8deb58b66521af86b4d3d4fd9">command_buffer</a>));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// note: in a preemtive env, the following would have to be protected</span></div>
<div class="line">    <span class="comment">// to be atomic as we modify static variables</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="name_8c.html#a0e25b9dc05d9d0c2b58510892dacd5eb">parse_filename</a>(command, &amp;<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>, 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// post-parse</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a> != <a class="code" href="cmd_8h.html#ab31350eb38b009cbd282027630a1ee10a93c1ce1fac89139d9f4df4b6db21b1cc">CMD_NONE</a> &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a> != <a class="code" href="cmd_8h.html#ab31350eb38b009cbd282027630a1ee10ab0bf742579d70a2f3ce2f4b28b85db72">CMD_DIR</a>) {</div>
<div class="line">        <span class="comment">// command name during open</span></div>
<div class="line">        <span class="comment">// this is in fact ignored by CBM DOS as checked with VICE&#39;s true drive emulation</span></div>
<div class="line">        <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;NO CORRECT CMD: %s\n&quot;</span>, <a class="code" href="cmd_8c.html#a638fac6ce8a134b11f8b5f8858af1e0a">command_to_name</a>(<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a>));</div>
<div class="line">        <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a> = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1d127017fb298b889f4ba24752d08b8e">type</a> != 0 &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1d127017fb298b889f4ba24752d08b8e">type</a> != <span class="charliteral">&#39;S&#39;</span> &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1d127017fb298b889f4ba24752d08b8e">type</a> != <span class="charliteral">&#39;P&#39;</span>) {</div>
<div class="line">        <span class="comment">// not set, or set as not sequential and not program</span></div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;UNKOWN FILE TYPE: &quot;</span>); <a class="code" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d">debug_putc</a>(<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1d127017fb298b889f4ba24752d08b8e">type</a>); <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a81d31f6c275ccf8cffb2cf8b4bea2195">ERROR_FILE_TYPE_MISMATCH</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != 0 &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != <span class="charliteral">&#39;W&#39;</span> &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != <span class="charliteral">&#39;R&#39;</span></div>
<div class="line">            &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != <span class="charliteral">&#39;A&#39;</span>) {</div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;UNKOWN FILE ACCESS TYPE &quot;</span>); <a class="code" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d">debug_putc</a>(<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a>); <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <span class="comment">// not set, or set as not read, write, or append</span></div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a7e6049a7128a53abd1faea40f121ab97">ERROR_SYNTAX_UNKNOWN</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a> == <a class="code" href="cmd_8h.html#ab31350eb38b009cbd282027630a1ee10ab0bf742579d70a2f3ce2f4b28b85db72">CMD_DIR</a> &amp;&amp; (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != 0 &amp;&amp; <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> != <span class="charliteral">&#39;R&#39;</span>)) {</div>
<div class="line">        <span class="comment">// trying to write to a directory</span></div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;WRITE TO DIRECTORY!&quot;</span>); <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a9c174c9b266e3a70ec4895d4c61ac047">ERROR_FILE_EXISTS</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    uint8_t type = <a class="code" href="wireformat_8h.html#af44b52313eddd3cd574a18101e22de9c">FS_OPEN_RD</a>;</div>
<div class="line">    <span class="comment">// either &quot;,W&quot; or secondary address is one, i.e. save</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> == <span class="charliteral">&#39;W&#39;</span> || is_save) type = <a class="code" href="wireformat_8h.html#a4f9bd5ed0ff3cd86af113a6fa3b3e953">FS_OPEN_WR</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a8b0d6200bc639dd37ff68847a0adde5f">access</a> == <span class="charliteral">&#39;A&#39;</span>) type = <a class="code" href="wireformat_8h.html#ad8a2dfefc31fec8a82c96e7b33229c30">FS_OPEN_AP</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a1aa03361e7476a96a22ac4dd7201ad68">cmd</a> == <a class="code" href="cmd_8h.html#ab31350eb38b009cbd282027630a1ee10ab0bf742579d70a2f3ce2f4b28b85db72">CMD_DIR</a>) type = <a class="code" href="wireformat_8h.html#ac276aef1b6489ff47ddda76bd9653102">FS_OPEN_DR</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8336bd2f1ed40fc3520412402061d43b">file_submit_call</a>(channel_no, type, errormsg, rtconf, <a class="code" href="serial_8c.html#ac7063263faf9c3950f983dea0effb3bf">callback</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_cgraph.png" border="0" usemap="#file_8h_a2dac9b9090b14532b84f96929c3cb2cc_cgraph" alt=""/></div>
<map name="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_cgraph" id="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_cgraph">
<area shape="rect" id="node3" href="cmd_8c.html#a638fac6ce8a134b11f8b5f8858af1e0a" title="command_to_name" alt="" coords="290,6,430,34"/><area shape="rect" id="node5" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d" title="debug_putc" alt="" coords="693,289,784,317"/><area shape="rect" id="node23" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2" title="debug_putcrlf" alt="" coords="309,210,411,238"/><area shape="rect" id="node35" href="file_8c.html#a8336bd2f1ed40fc3520412402061d43b" title="file_submit_call" alt="" coords="130,623,243,651"/><area shape="rect" id="node70" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="323,986,397,1014"/><area shape="rect" id="node86" href="name_8c.html#a0e25b9dc05d9d0c2b58510892dacd5eb" title="parse_filename" alt="" coords="130,110,243,138"/><area shape="rect" id="node7" href="term_8c.html#ab38e92632b4de8af92283e500910a510" title="term_putc" alt="" coords="845,289,926,317"/><area shape="rect" id="node9" href="packet_8h.html#a2cade8ffc72b19e08f8fbff1ce795417" title="packet_wait_done" alt="" coords="977,237,1106,265"/><area shape="rect" id="node17" href="term_8c.html#ad6b6b9297aa30da49f6dc3422bf708a4" title="send" alt="" coords="1016,289,1066,317"/><area shape="rect" id="node11" href="packet_8h.html#ae18177b6d0283a274422f843fb924d81" title="packet_is_done" alt="" coords="1157,237,1272,265"/><area shape="rect" id="node13" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="1179,289,1250,317"/><area shape="rect" id="node15" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="1336,237,1429,265"/><area shape="rect" id="node19" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="1154,727,1275,755"/><area shape="rect" id="node21" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="1323,727,1443,755"/><area shape="rect" id="node25" href="term_8c.html#ae337008fc505247280226b35d89757d0" title="term_flush" alt="" coords="844,185,927,213"/><area shape="rect" id="node31" href="term_8c.html#ab6dcca8982478b8e68429b51f690b568" title="term_putcrlf" alt="" coords="693,237,785,265"/><area shape="rect" id="node28" href="serial_8c.html#a94547a891c369354cec16547930de449" title="serial_flush" alt="" coords="997,185,1086,213"/><area shape="rect" id="node37" href="file_8c.html#ab5706f892355991d509f217c579c0ee4" title="_file_open_callback" alt="" coords="291,934,429,962"/><area shape="rect" id="node39" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="307,598,413,626"/><area shape="rect" id="node43" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="690,675,787,703"/><area shape="rect" id="node47" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="696,443,781,471"/><area shape="rect" id="node55" href="channel_8c.html#a9e50fcfde4df544d0129c1b56a7a6359" title="channel_open" alt="" coords="307,830,413,858"/><area shape="rect" id="node61" href="debug_8h.html#a5a19c73a805a191cb89658d3a3fc308f" title="debug_puthex" alt="" coords="307,365,413,393"/><area shape="rect" id="node68" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844" title="provider_lookup" alt="" coords="302,650,418,678"/><area shape="rect" id="node41" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="499,625,613,653"/><area shape="rect" id="node45" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="492,469,620,497"/><area shape="rect" id="node51" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="478,573,634,601"/><area shape="rect" id="node57" href="packet_8h.html#ad61c5a329d6379bd96faf0a29b1b565f" title="packet_reset" alt="" coords="507,830,605,858"/><area shape="rect" id="node63" href="debug_8h.html#a5dd69e91857c89f722568ab6eb8b95da" title="debug_putnib" alt="" coords="505,365,607,393"/><area shape="rect" id="node72" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="510,986,602,1014"/><area shape="rect" id="node74" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="693,1038,784,1066"/><area shape="rect" id="node76" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="683,934,794,962"/><area shape="rect" id="node78" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="707,986,771,1014"/><area shape="rect" id="node80" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="851,934,920,962"/><area shape="rect" id="node82" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="851,986,920,1014"/><area shape="rect" id="node84" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="853,1038,918,1066"/><area shape="rect" id="node88" href="cmd_8c.html#ab9643f90107f881d6ccbdcc75f2af424" title="command_find" alt="" coords="306,58,414,86"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_icgraph.png" border="0" usemap="#file_8h_a2dac9b9090b14532b84f96929c3cb2cc_icgraph" alt=""/></div>
<map name="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_icgraph" id="file_8h_a2dac9b9090b14532b84f96929c3cb2cc_icgraph">
<area shape="rect" id="node3" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="131,5,229,33"/><area shape="rect" id="node5" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="277,5,379,33"/><area shape="rect" id="node7" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="427,5,589,33"/><area shape="rect" id="node9" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="638,5,688,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8336bd2f1ed40fc3520412402061d43b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t file_submit_call </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>channel_no</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structerrormsg__t.html">errormsg_t</a> *&#160;</td>
          <td class="paramname"><em>errormsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrtconfig__t.html">rtconfig_t</a> *&#160;</td>
          <td class="paramname"><em>rtconf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(int8_t errnum, uint8_t *rxdata)&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="file_8c_source.html#l00126">126</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00226">_file_open_callback()</a>, <a class="el" href="assert_8h_source.html#l00030">assert_not_null</a>, <a class="el" href="file_8c_source.html#l00049">open_t::callback</a>, <a class="el" href="serial_8c_source.html#l00119">callback</a>, <a class="el" href="channel_8c_source.html#l00250">channel_close()</a>, <a class="el" href="channel_8c_source.html#l00127">channel_find()</a>, <a class="el" href="file_8c_source.html#l00045">open_t::channel_no</a>, <a class="el" href="channel_8c_source.html#l00103">channel_open()</a>, <a class="el" href="debug_8h_source.html#l00038">debug_putc()</a>, <a class="el" href="debug_8h_source.html#l00039">debug_putcrlf()</a>, <a class="el" href="debug_8h_source.html#l00055">debug_puthex()</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="provider_8h_source.html#l00049">provider_t::directory_converter</a>, <a class="el" href="name_8h_source.html#l00034">nameinfo_t::drive</a>, <a class="el" href="provider_8c_source.html#l00046">endpoint</a>, <a class="el" href="errors_8h_source.html#l00069">ERROR_DRIVE_NOT_READY</a>, <a class="el" href="errors_8h_source.html#l00065">ERROR_NO_CHANNEL</a>, <a class="el" href="errors_8h_source.html#l00046">ERROR_SYNTAX_NONAME</a>, <a class="el" href="wireformat_8h_source.html#l00054">FS_OPEN_AP</a>, <a class="el" href="wireformat_8h_source.html#l00055">FS_OPEN_DR</a>, <a class="el" href="wireformat_8h_source.html#l00051">FS_OPEN_WR</a>, <a class="el" href="rtconfig_8h_source.html#l00036">rtconfig_t::last_used_drive</a>, <a class="el" href="file_8c_source.html#l00039">MAX_ACTIVE_OPEN</a>, <a class="el" href="name_8h_source.html#l00038">nameinfo_t::name</a>, <a class="el" href="name_8c_source.html#l00047">nameinfo</a>, <a class="el" href="name_8h_source.html#l00039">nameinfo_t::namelen</a>, <a class="el" href="file_8c_source.html#l00040">OPEN_RX_DATA_LEN</a>, <a class="el" href="packet_8h_source.html#l00099">packet_init()</a>, <a class="el" href="packet_8h_source.html#l00146">packet_set_filled()</a>, <a class="el" href="provider_8h_source.html#l00058">endpoint_t::provdata</a>, <a class="el" href="provider_8c_source.html#l00040">provider</a>, <a class="el" href="provider_8h_source.html#l00057">endpoint_t::provider</a>, <a class="el" href="provider_8c_source.html#l00170">provider_lookup()</a>, <a class="el" href="file_8c_source.html#l00047">open_t::rxbuf</a>, <a class="el" href="file_8c_source.html#l00048">open_t::rxdata</a>, <a class="el" href="errormsg_8h_source.html#l00052">set_error()</a>, <a class="el" href="provider_8h_source.html#l00045">provider_t::submit_call</a>, <a class="el" href="provider_8h_source.html#l00053">provider_t::to_provider</a>, and <a class="el" href="file_8c_source.html#l00046">open_t::txbuf</a>.</p>

<p>Referenced by <a class="el" href="cmd_8c_source.html#l00118">command_execute()</a>, and <a class="el" href="file_8c_source.html#l00069">file_open()</a>.</p>
<div class="fragment"><div class="line">                                                          {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="assert_8h.html#a4aac76133d59f061a6a1c3655ad0293a">assert_not_null</a>(errormsg, <span class="stringliteral">&quot;file_submit_call: errormsg is null&quot;</span>);</div>
<div class="line">    <a class="code" href="assert_8h.html#a4aac76133d59f061a6a1c3655ad0293a">assert_not_null</a>(rtconf, <span class="stringliteral">&quot;file_submit_call: rtconf is null&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check for default drive (here is the place to set the last used one)</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a3f7026e41497f11cac6febb94464474c">drive</a> == 0xff) {</div>
<div class="line">        <span class="comment">// there currently only is a single drive, 0</span></div>
<div class="line">        <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a3f7026e41497f11cac6febb94464474c">drive</a> = rtconf-&gt;<a class="code" href="structrtconfig__t.html#ae23056a231145b898403540c369620c7">last_used_drive</a>;</div>
<div class="line">        <span class="comment">// TODO: fix this hack!</span></div>
<div class="line">        <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#ad18ffb857d1568f56c3b0e49a1569d8b">name</a>[0] = rtconf-&gt;<a class="code" href="structrtconfig__t.html#ae23056a231145b898403540c369620c7">last_used_drive</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// here is the place to plug in other file system providers,</span></div>
<div class="line">    <span class="comment">// like SD-Card, or even an outgoing IEC or IEEE, to convert between</span></div>
<div class="line">    <span class="comment">// the two bus systems. This is done depending on the drive number</span></div>
<div class="line">    <span class="comment">// and managed with the ASSIGN call.</span></div>
<div class="line">    <span class="comment">//provider_t *provider = &amp;serial_provider;</span></div>
<div class="line">    <a class="code" href="structendpoint__t.html">endpoint_t</a> *<a class="code" href="provider_8c.html#a291780275a2d0d648e1f15968dc271d1">endpoint</a> = <a class="code" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844">provider_lookup</a>(<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a3f7026e41497f11cac6febb94464474c">drive</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// check the validity of the drive (note that in general provider_lookup</span></div>
<div class="line">    <span class="comment">// returns a default provider - serial-over-USB to the PC, which then </span></div>
<div class="line">    <span class="comment">// may do further checks</span></div>
<div class="line">    <span class="keywordflow">if</span> (endpoint == NULL) {</div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;ILLEGAL DRIVE: &quot;</span>); <a class="code" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d">debug_putc</a>(0x30+<a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a3f7026e41497f11cac6febb94464474c">drive</a>); <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629aa93d4f29ed671f857ef74597386f4c53">ERROR_DRIVE_NOT_READY</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="structprovider__t.html">provider_t</a> *<a class="code" href="provider_8c.html#a9cfb091f3898a26be41690ceec533d6d">provider</a> = endpoint-&gt;<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// find open slot</span></div>
<div class="line">    <span class="comment">//int8_t slot = -1;</span></div>
<div class="line">    <a class="code" href="structopen__t.html">open_t</a> *activeslot = NULL;</div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="file_8c.html#a30d87a09ef110b7f895835b50f40114e">MAX_ACTIVE_OPEN</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="file_8c.html#a36781be560f0c4f1d4bae71e363e0650">active</a>[i].channel_no &lt; 0) {</div>
<div class="line">            <span class="comment">//slot = i;</span></div>
<div class="line">            activeslot = (<a class="code" href="structopen__t.html">open_t</a>*) &amp;<a class="code" href="file_8c.html#a36781be560f0c4f1d4bae71e363e0650">active</a>[i];</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//if (slot &lt; 0) {</span></div>
<div class="line">    <span class="keywordflow">if</span> (activeslot == NULL) {</div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;NO OPEN SLOT FOR OPEN!&quot;</span>);</div>
<div class="line">        <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a7589e08ede7adcce165088620dc00574">ERROR_NO_CHANNEL</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada">packet_init</a>(&amp;activeslot-&gt;<a class="code" href="structopen__t.html#ab5a3020e0fcab67fb762d0e52e699cbc">txbuf</a>, <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a580e4f7b110590986a4d2ff8bd948efd">namelen</a>, <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#ad18ffb857d1568f56c3b0e49a1569d8b">name</a>);</div>
<div class="line">    <a class="code" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53">packet_set_filled</a>(&amp;activeslot-&gt;<a class="code" href="structopen__t.html#ab5a3020e0fcab67fb762d0e52e699cbc">txbuf</a>, channel_no, type, <a class="code" href="name_8c.html#a4cde0527f934e25ea5a5c4bd17358bf3">nameinfo</a>.<a class="code" href="structnameinfo__t.html#a580e4f7b110590986a4d2ff8bd948efd">namelen</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (provider-&gt;<a class="code" href="structprovider__t.html#a408bbe2647fa8a67a0c3e1fc12990cee">to_provider</a> != NULL &amp;&amp; provider-&gt;<a class="code" href="structprovider__t.html#a408bbe2647fa8a67a0c3e1fc12990cee">to_provider</a>(&amp;activeslot-&gt;<a class="code" href="structopen__t.html#ab5a3020e0fcab67fb762d0e52e699cbc">txbuf</a>) &lt; 0) {</div>
<div class="line">        <span class="comment">// converting the file name to the provider exceeded the buffer space</span></div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;NAME CONVERSION EXCEEDS BUFFER!&quot;</span>);</div>
<div class="line">        <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629afdd3eceaa02265a10a4e7b8b0b51d120">ERROR_SYNTAX_NONAME</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// open channel</span></div>
<div class="line">    uint8_t writetype = (type == <a class="code" href="wireformat_8h.html#a4f9bd5ed0ff3cd86af113a6fa3b3e953">FS_OPEN_WR</a> || type == <a class="code" href="wireformat_8h.html#ad8a2dfefc31fec8a82c96e7b33229c30">FS_OPEN_AP</a>) ? 1 : 0;</div>
<div class="line">    int8_t (*converter)(<a class="code" href="structpacket__t.html">packet_t</a>*) = (type == <a class="code" href="wireformat_8h.html#ac276aef1b6489ff47ddda76bd9653102">FS_OPEN_DR</a>) ? (provider-&gt;<a class="code" href="structprovider__t.html#a49f2828bbee5e15d5325a80831adb4c9">directory_converter</a>) : NULL;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structchannel__t.html">channel_t</a> *channel = <a class="code" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df">channel_find</a>(channel_no);</div>
<div class="line">    <span class="keywordflow">if</span> (channel != NULL) {</div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;FILE OPEN ERROR&quot;</span>);</div>
<div class="line">        <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a7589e08ede7adcce165088620dc00574">ERROR_NO_CHANNEL</a>);</div>
<div class="line">        <span class="comment">// clean up</span></div>
<div class="line">        <a class="code" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b">channel_close</a>(channel_no);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    int8_t e = <a class="code" href="channel_8c.html#a9e50fcfde4df544d0129c1b56a7a6359">channel_open</a>(channel_no, writetype, endpoint, converter);</div>
<div class="line">    <span class="keywordflow">if</span> (e &lt; 0) {</div>
<div class="line">        <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;E=&quot;</span>); <a class="code" href="debug_8h.html#a5a19c73a805a191cb89658d3a3fc308f">debug_puthex</a>(e); <a class="code" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2">debug_putcrlf</a>();</div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(errormsg, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a7589e08ede7adcce165088620dc00574">ERROR_NO_CHANNEL</a>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    activeslot-&gt;<a class="code" href="structopen__t.html#a713995e0ea4d6edab33bc6172e41a98d">callback</a> = <a class="code" href="serial_8c.html#ac7063263faf9c3950f983dea0effb3bf">callback</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// no more error here, just the submit.</span></div>
<div class="line">    <span class="comment">// so callers can be sure if this function returns &lt;0, they do not need</span></div>
<div class="line">    <span class="comment">// to close the channel, as it has not been opened</span></div>
<div class="line">    <span class="comment">// If this function returns 0, a callback must be received and handled,</span></div>
<div class="line">    <span class="comment">// and the channel is already opened.</span></div>
<div class="line">        </div>
<div class="line">    activeslot-&gt;<a class="code" href="structopen__t.html#ad5e3813af7610093f319c97eeb342464">channel_no</a> = channel_no;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// prepare response buffer</span></div>
<div class="line">    <a class="code" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada">packet_init</a>(&amp;activeslot-&gt;<a class="code" href="structopen__t.html#a5bb7692161b08d411daa102b9b9d9de2">rxbuf</a>, <a class="code" href="file_8c.html#ae87cf5c120344a6a1d6f2825d0d3ef0b">OPEN_RX_DATA_LEN</a>, activeslot-&gt;<a class="code" href="structopen__t.html#a23fb3233fb31dcea986746abc638f390">rxdata</a>);</div>
<div class="line">    </div>
<div class="line">    provider-&gt;<a class="code" href="structprovider__t.html#a83364419e376b47abca69af29ef44d0d">submit_call</a>(endpoint-&gt;<a class="code" href="structendpoint__t.html#ad4e08597462bc0b0e400c3784397612d">provdata</a>, channel_no, &amp;activeslot-&gt;<a class="code" href="structopen__t.html#ab5a3020e0fcab67fb762d0e52e699cbc">txbuf</a>, </div>
<div class="line">            &amp;activeslot-&gt;<a class="code" href="structopen__t.html#a5bb7692161b08d411daa102b9b9d9de2">rxbuf</a>, <a class="code" href="file_8c.html#ab5706f892355991d509f217c579c0ee4">_file_open_callback</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h_a8336bd2f1ed40fc3520412402061d43b_cgraph.png" border="0" usemap="#file_8h_a8336bd2f1ed40fc3520412402061d43b_cgraph" alt=""/></div>
<map name="file_8h_a8336bd2f1ed40fc3520412402061d43b_cgraph" id="file_8h_a8336bd2f1ed40fc3520412402061d43b_cgraph">
<area shape="rect" id="node3" href="file_8c.html#ab5706f892355991d509f217c579c0ee4" title="_file_open_callback" alt="" coords="165,5,304,33"/><area shape="rect" id="node5" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="181,314,288,342"/><area shape="rect" id="node9" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="565,366,662,394"/><area shape="rect" id="node13" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="571,237,656,265"/><area shape="rect" id="node22" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="1029,158,1150,186"/><area shape="rect" id="node27" href="channel_8c.html#a9e50fcfde4df544d0129c1b56a7a6359" title="channel_open" alt="" coords="182,674,287,702"/><area shape="rect" id="node31" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d" title="debug_putc" alt="" coords="568,519,659,547"/><area shape="rect" id="node43" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2" title="debug_putcrlf" alt="" coords="380,623,482,651"/><area shape="rect" id="node55" href="debug_8h.html#a5a19c73a805a191cb89658d3a3fc308f" title="debug_puthex" alt="" coords="182,519,288,547"/><area shape="rect" id="node62" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844" title="provider_lookup" alt="" coords="177,726,293,754"/><area shape="rect" id="node64" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="197,778,272,806"/><area shape="rect" id="node7" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="374,314,487,342"/><area shape="rect" id="node11" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="367,262,495,290"/><area shape="rect" id="node16" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="1054,481,1125,509"/><area shape="rect" id="node20" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="353,210,508,238"/><area shape="rect" id="node18" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="1211,545,1304,573"/><area shape="rect" id="node24" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="1197,158,1317,186"/><area shape="rect" id="node29" href="packet_8h.html#ad61c5a329d6379bd96faf0a29b1b565f" title="packet_reset" alt="" coords="382,675,480,703"/><area shape="rect" id="node33" href="term_8c.html#ab38e92632b4de8af92283e500910a510" title="term_putc" alt="" coords="720,519,800,547"/><area shape="rect" id="node35" href="packet_8h.html#a2cade8ffc72b19e08f8fbff1ce795417" title="packet_wait_done" alt="" coords="852,519,980,547"/><area shape="rect" id="node40" href="term_8c.html#ad6b6b9297aa30da49f6dc3422bf708a4" title="send" alt="" coords="891,571,941,599"/><area shape="rect" id="node37" href="packet_8h.html#ae18177b6d0283a274422f843fb924d81" title="packet_is_done" alt="" coords="1032,533,1147,561"/><area shape="rect" id="node45" href="term_8c.html#ae337008fc505247280226b35d89757d0" title="term_flush" alt="" coords="718,623,802,651"/><area shape="rect" id="node51" href="term_8c.html#ab6dcca8982478b8e68429b51f690b568" title="term_putcrlf" alt="" coords="567,571,659,599"/><area shape="rect" id="node48" href="serial_8c.html#a94547a891c369354cec16547930de449" title="serial_flush" alt="" coords="872,623,960,651"/><area shape="rect" id="node57" href="debug_8h.html#a5dd69e91857c89f722568ab6eb8b95da" title="debug_putnib" alt="" coords="380,519,482,547"/><area shape="rect" id="node66" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="384,778,477,806"/><area shape="rect" id="node68" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="568,726,659,754"/><area shape="rect" id="node70" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="558,778,669,806"/><area shape="rect" id="node72" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="581,830,645,858"/><area shape="rect" id="node74" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="726,778,794,806"/><area shape="rect" id="node76" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="726,830,794,858"/><area shape="rect" id="node78" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="727,882,793,910"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="file_8h_a8336bd2f1ed40fc3520412402061d43b_icgraph.png" border="0" usemap="#file_8h_a8336bd2f1ed40fc3520412402061d43b_icgraph" alt=""/></div>
<map name="file_8h_a8336bd2f1ed40fc3520412402061d43b_icgraph" id="file_8h_a8336bd2f1ed40fc3520412402061d43b_icgraph">
<area shape="rect" id="node3" href="cmd2_8h.html#abaf24aaeaa145dec95026ae71251be71" title="command_execute" alt="" coords="165,5,299,33"/><area shape="rect" id="node13" href="file_8h.html#a2dac9b9090b14532b84f96929c3cb2cc" title="file_open" alt="" coords="194,57,270,85"/><area shape="rect" id="node5" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="347,31,445,59"/><area shape="rect" id="node7" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="493,31,595,59"/><area shape="rect" id="node9" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="643,31,805,59"/><area shape="rect" id="node11" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="854,31,904,59"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 4 2012 04:34:51 for XD2031 firmware by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
