<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>XD2031 firmware: provider.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XD2031 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">provider.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;inttypes.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="packet_8h_source.html">packet.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="errormsg_8h_source.html">errormsg.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for provider.h:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h__incl.png" border="0" usemap="#provider_8h" alt=""/></div>
<map name="provider_8h" id="provider_8h">
<area shape="rect" id="node5" href="packet_8h.html" title="packet.h" alt="" coords="103,83,173,111"/><area shape="rect" id="node20" href="errormsg_8h.html" title="errormsg.h" alt="" coords="313,161,399,189"/><area shape="rect" id="node8" href="wireformat_8h.html" title="wireformat.h" alt="" coords="194,161,288,189"/><area shape="rect" id="node12" href="delay_8h.html" title="delay.h" alt="" coords="107,161,169,189"/><area shape="rect" id="node10" href="errors_8h.html" title="errors.h" alt="" coords="208,238,275,266"/><area shape="rect" id="node14" href="delayhw_8h.html" title="delayhw.h" alt="" coords="101,238,181,266"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h__dep__incl.png" border="0" usemap="#provider_8hdep" alt=""/></div>
<map name="provider_8hdep" id="provider_8hdep">
<area shape="rect" id="node3" href="term_8h.html" title="term.h" alt="" coords="707,83,766,111"/><area shape="rect" id="node13" href="channel_8c.html" title="channel.c" alt="" coords="949,238,1027,266"/><area shape="rect" id="node24" href="provider_8c.html" title="provider.c" alt="" coords="846,238,924,266"/><area shape="rect" id="node28" href="serial_8c.html" title="serial.c" alt="" coords="1134,238,1196,266"/><area shape="rect" id="node34" href="channel_8h.html" title="channel.h" alt="" coords="230,83,308,111"/><area shape="rect" id="node53" href="serial_8h.html" title="serial.h" alt="" coords="1034,161,1098,189"/><area shape="rect" id="node5" href="debug_8h.html" title="debug.h" alt="" coords="610,161,679,189"/><area shape="rect" id="node30" href="main_8c.html" title="main.c" alt="" coords="239,238,299,266"/><area shape="rect" id="node32" href="term_8c.html" title="term.c" alt="" coords="1051,238,1108,266"/><area shape="rect" id="node7" href="assert_8h.html" title="assert.h" alt="" coords="565,238,632,266"/><area shape="rect" id="node9" href="file_8c.html" title="file.c" alt="" coords="503,315,551,343"/><area shape="rect" id="node11" href="bus_8c.html" title="bus.c" alt="" coords="31,238,83,266"/><area shape="rect" id="node15" href="cmd_8c.html" title="cmd.c" alt="" coords="159,238,215,266"/><area shape="rect" id="node17" href="errormsg_8c.html" title="errormsg.c" alt="" coords="405,238,488,266"/><area shape="rect" id="node20" href="ieee_8c.html" title="ieee.c" alt="" coords="324,238,380,266"/><area shape="rect" id="node22" href="name_8c.html" title="name.c" alt="" coords="657,238,722,266"/><area shape="rect" id="node26" href="rtconfig_8c.html" title="rtconfig.c" alt="" coords="747,238,822,266"/><area shape="rect" id="node37" href="cmd2_8h.html" title="cmd2.h" alt="" coords="93,161,158,189"/><area shape="rect" id="node41" href="file_8h.html" title="file.h" alt="" coords="182,161,231,189"/></map>
</div>
</div>
<p><a href="provider_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structprovider__t.html">provider_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structendpoint__t.html">endpoint_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2fb3453f8017a7e05b4b0a0a1f7e9203"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="provider_8h.html#a2fb3453f8017a7e05b4b0a0a1f7e9203">provider_assign</a> (uint8_t <a class="el" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>, const char *<a class="el" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a2fb3453f8017a7e05b4b0a0a1f7e9203"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1d09b1d2054aca48a208914b24a5844"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structendpoint__t.html">endpoint_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="provider_8h.html#ab1d09b1d2054aca48a208914b24a5844">provider_lookup</a> (uint8_t <a class="el" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>)</td></tr>
<tr class="separator:ab1d09b1d2054aca48a208914b24a5844"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06db895b61451664078b527c6e16b2ca"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="provider_8h.html#a06db895b61451664078b527c6e16b2ca">provider_register</a> (const char *<a class="el" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="structprovider__t.html">provider_t</a> *<a class="el" href="provider_8c.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>)</td></tr>
<tr class="separator:a06db895b61451664078b527c6e16b2ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc1392ee6ef82e9fecb6e110eed65212"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="provider_8h.html#adc1392ee6ef82e9fecb6e110eed65212">provider_set_default</a> (<a class="el" href="structprovider__t.html">provider_t</a> *prov, void *epdata)</td></tr>
<tr class="separator:adc1392ee6ef82e9fecb6e110eed65212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab28e292d9ece77f1b5cd150bdff218e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="provider_8h.html#ab28e292d9ece77f1b5cd150bdff218e0">provider_init</a> (void)</td></tr>
<tr class="separator:ab28e292d9ece77f1b5cd150bdff218e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a2fb3453f8017a7e05b4b0a0a1f7e9203"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t provider_assign </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>drive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The assign process assigns the drive to a provider. I.e. the drive is so far unused (or will be overwritten), and the code has to determine just from the name, which provider to use.</p>
<p>The name starts with an alphanumeric string, followed by a colon. After that, it depends on the provider. If that string is a digit, it is the notation relative to an existing drive's provider. Relative here means that for example a subdirectory can by used. If the string is not a digit, it will be looked up in the list of registered providers. If found, the whole name will be used to retrieve a new endpoint provider. Note that the whole name is used to allow one provider handle/use multiple endpoints e.g. in terms of subdirectory.</p>
<p>If no provider is found, this code returns an error, and the calling code forwards the request to the default provider that is always returned when no assignment can be found.</p>
<p>Note that if an assigned drive is used to assign a new name, the assignment of that drive is removed. This enables the use of the default provider when the assign returns after error, to forward the assign command. Also this enables the use of a server-based provider that is not hidden by an old definition on this device. </p>

<p>Definition at line <a class="el" href="provider_8c_source.html#l00074">74</a> of file <a class="el" href="provider_8c_source.html">provider.c</a>.</p>

<p>References <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="provider_8c_source.html#l00045">drive</a>, <a class="el" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>, <a class="el" href="provider_8c_source.html#l00034">MAX_DRIVES</a>, <a class="el" href="provider_8c_source.html#l00032">MAX_PROV</a>, <a class="el" href="provider_8h_source.html#l00039">provider_t::prov_assign</a>, <a class="el" href="provider_8h_source.html#l00057">endpoint_t::provider</a>, <a class="el" href="provider_8c_source.html#l00170">provider_lookup()</a>, and <a class="el" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>.</p>

<p>Referenced by <a class="el" href="cmd_8c_source.html#l00118">command_execute()</a>.</p>
<div class="fragment"><div class="line">                                                        {</div>
<div class="line"></div>
<div class="line">    int8_t rv = -1;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;ASSIGN: drive %d to &#39;%s&#39;\n&quot;</span>, <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>, <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// check drive</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a> &gt; 10) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// first find the colon</span></div>
<div class="line">    uint8_t p = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[p] != 0 &amp;&amp; <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[p] != <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line">        p++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structprovider__t.html">provider_t</a> *newprov = NULL;</div>
<div class="line">    <span class="keywordtype">void</span> *provdata = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((isdigit(<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[0])) &amp;&amp; (p == 1)) {</div>
<div class="line">        <span class="comment">// we have a drive digit</span></div>
<div class="line">        uint8_t drv = <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[0] &amp; 0x0f;</div>
<div class="line">        <a class="code" href="structendpoint__t.html">endpoint_t</a> *ep = <a class="code" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844">provider_lookup</a>(drv);</div>
<div class="line">        <span class="keywordflow">if</span> (ep == NULL) {</div>
<div class="line">            <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Drive %d not used, cannot do relative assign!\n&quot;</span>, drv);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ep == &amp;<a class="code" href="provider_8c.html#a210a908b8caea35007419c83e5d3c3e2">default_provider</a>) {</div>
<div class="line">            <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;Default is not registered, forwarding to server\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        newprov = ep-&gt;<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>;</div>
<div class="line">        <span class="comment">// currently a relative assignment is not supported</span></div>
<div class="line">        provdata = newprov-&gt;<a class="code" href="structprovider__t.html#a2e8b8e9002d9bfc8492c668c9304c59a">prov_assign</a>(<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (newprov == NULL) {</div>
<div class="line">        <span class="comment">// now check each provider in turn, if the name fits</span></div>
<div class="line">        <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#aa09a7ba5d2edcf32daab1f094eb07e77">MAX_PROV</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        uint8_t j;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> != NULL) {</div>
<div class="line">            <span class="comment">//debug_printf(&quot;Compare with %s\n&quot;,provs[i].name);  </span></div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; p; j++) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[j] != <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[j]) {</div>
<div class="line">                    <span class="comment">// name does not match</span></div>
<div class="line">                    <span class="comment">//debug_printf(&quot;name does not match at i=%d, j=%d (%02x vs. %02x\n&quot;, </span></div>
<div class="line">                    <span class="comment">//      i, j, provs[i].name[j], name[j]);</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">//debug_printf(&quot;j=%d, p=%d, %02x\n&quot;, j, p, provs[i].name[p]);</span></div>
<div class="line">            <span class="keywordflow">if</span> ((j == p) &amp;&amp; (<a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[p] == 0)) {</div>
<div class="line">                <span class="comment">// found it</span></div>
<div class="line">                <span class="comment">//debug_printf(&quot;Found new provider: %p in slot %d\n&quot;, p, i);</span></div>
<div class="line">                newprov = <a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].provider;</div>
<div class="line">                <span class="comment">// new get the runtime data</span></div>
<div class="line">                provdata = newprov-&gt;<a class="code" href="structprovider__t.html#a2e8b8e9002d9bfc8492c668c9304c59a">prov_assign</a>(<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// when we are going to return, remove</span></div>
<div class="line">    <span class="comment">// the old assign mapping</span></div>
<div class="line">    <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#ac19160d3e5643c18e6903cd41b5bbc98">MAX_DRIVES</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].<a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a> == <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>) {</div>
<div class="line">            <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].drive = -1;</div>
<div class="line">            <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].endpoint.provider = NULL;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (newprov != NULL) {</div>
<div class="line">        <span class="comment">// got one, so register it</span></div>
<div class="line">        <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#ac19160d3e5643c18e6903cd41b5bbc98">MAX_DRIVES</a>-1; i &gt;= 0; i--) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].<a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a> == -1) {</div>
<div class="line">                <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].drive = <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>;</div>
<div class="line">                <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].endpoint.provider = newprov;</div>
<div class="line">                <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].endpoint.provdata = provdata;</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>                <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Register prov %p for drive %d with data %p in slot %d\n&quot;</span>,</div>
<div class="line">                    newprov, <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>, provdata, i);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                rv = 0; </div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_cgraph.png" border="0" usemap="#provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_cgraph" alt=""/></div>
<map name="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_cgraph" id="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_cgraph">
<area shape="rect" id="node3" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844" title="provider_lookup" alt="" coords="171,5,287,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_icgraph.png" border="0" usemap="#provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_icgraph" alt=""/></div>
<map name="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_icgraph" id="provider_8h_a2fb3453f8017a7e05b4b0a0a1f7e9203_icgraph">
<area shape="rect" id="node3" href="cmd2_8h.html#abaf24aaeaa145dec95026ae71251be71" title="command_execute" alt="" coords="170,5,304,33"/><area shape="rect" id="node5" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="352,5,451,33"/><area shape="rect" id="node7" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="499,5,600,33"/><area shape="rect" id="node9" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="648,5,811,33"/><area shape="rect" id="node11" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="859,5,909,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab28e292d9ece77f1b5cd150bdff218e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void provider_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="provider_8c_source.html#l00211">211</a> of file <a class="el" href="provider_8c_source.html">provider.c</a>.</p>

<p>References <a class="el" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>, <a class="el" href="provider_8c_source.html#l00034">MAX_DRIVES</a>, <a class="el" href="provider_8c_source.html#l00032">MAX_PROV</a>, and <a class="el" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00082">main()</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">    <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#aa09a7ba5d2edcf32daab1f094eb07e77">MAX_PROV</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        <a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].provider = NULL;</div>
<div class="line">        <a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].name = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#ac19160d3e5643c18e6903cd41b5bbc98">MAX_DRIVES</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].endpoint.provider = NULL;</div>
<div class="line">        <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].drive = -1;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h_ab28e292d9ece77f1b5cd150bdff218e0_icgraph.png" border="0" usemap="#provider_8h_ab28e292d9ece77f1b5cd150bdff218e0_icgraph" alt=""/></div>
<map name="provider_8h_ab28e292d9ece77f1b5cd150bdff218e0_icgraph" id="provider_8h_ab28e292d9ece77f1b5cd150bdff218e0_icgraph">
<area shape="rect" id="node3" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="147,5,197,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1d09b1d2054aca48a208914b24a5844"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structendpoint__t.html">endpoint_t</a>* provider_lookup </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>drive</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="provider_8c_source.html#l00170">170</a> of file <a class="el" href="provider_8c_source.html">provider.c</a>.</p>

<p>References <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="provider_8c_source.html#l00036">default_provider</a>, <a class="el" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>, <a class="el" href="provider_8c_source.html#l00046">endpoint</a>, <a class="el" href="provider_8c_source.html#l00034">MAX_DRIVES</a>, and <a class="el" href="provider_8h_source.html#l00057">endpoint_t::provider</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l00126">file_submit_call()</a>, and <a class="el" href="provider_8c_source.html#l00074">provider_assign()</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;provider_lookup for drive %d\n&quot;</span>, <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#ac19160d3e5643c18e6903cd41b5bbc98">MAX_DRIVES</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].<a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a> == <a class="code" href="provider_8c.html#aef5c6747f61682aaab4a2bff90049947">drive</a>) &amp;&amp; (<a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].<a class="code" href="provider_8c.html#a291780275a2d0d648e1f15968dc271d1">endpoint</a>.<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a> != NULL)) {</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>            <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;found %p in slot %d (default=%p)\n&quot;</span>, </div>
<div class="line">                <a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].<a class="code" href="provider_8c.html#a291780275a2d0d648e1f15968dc271d1">endpoint</a>.<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>, i, <a class="code" href="provider_8c.html#a210a908b8caea35007419c83e5d3c3e2">default_provider</a>.<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">return</span> &amp;(<a class="code" href="provider_8c.html#a16f811cd6d1fdbe2c69a045564db5f23">drives</a>[i].endpoint);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;not found, returning default\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> &amp;<a class="code" href="provider_8c.html#a210a908b8caea35007419c83e5d3c3e2">default_provider</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h_ab1d09b1d2054aca48a208914b24a5844_icgraph.png" border="0" usemap="#provider_8h_ab1d09b1d2054aca48a208914b24a5844_icgraph" alt=""/></div>
<map name="provider_8h_ab1d09b1d2054aca48a208914b24a5844_icgraph" id="provider_8h_ab1d09b1d2054aca48a208914b24a5844_icgraph">
<area shape="rect" id="node3" href="file_8h.html#a8336bd2f1ed40fc3520412402061d43b" title="file_submit_call" alt="" coords="173,57,286,85"/><area shape="rect" id="node18" href="provider_8h.html#a2fb3453f8017a7e05b4b0a0a1f7e9203" title="provider_assign" alt="" coords="172,5,287,33"/><area shape="rect" id="node5" href="cmd2_8h.html#abaf24aaeaa145dec95026ae71251be71" title="command_execute" alt="" coords="336,5,470,33"/><area shape="rect" id="node15" href="file_8h.html#a2dac9b9090b14532b84f96929c3cb2cc" title="file_open" alt="" coords="365,57,440,85"/><area shape="rect" id="node7" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="517,31,616,59"/><area shape="rect" id="node9" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="664,31,765,59"/><area shape="rect" id="node11" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="813,31,976,59"/><area shape="rect" id="node13" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="1024,31,1074,59"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a06db895b61451664078b527c6e16b2ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t provider_register </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structprovider__t.html">provider_t</a> *&#160;</td>
          <td class="paramname"><em>provider</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="provider_8c_source.html#l00190">190</a> of file <a class="el" href="provider_8c_source.html">provider.c</a>.</p>

<p>References <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="provider_8c_source.html#l00032">MAX_PROV</a>, <a class="el" href="provider_8c_source.html#l00039">name</a>, <a class="el" href="provider_8c_source.html#l00040">provider</a>, and <a class="el" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>.</p>
<div class="fragment"><div class="line">                                                                  {</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_PROVIDER</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Register provider %p for &#39;%s&#39;\n&quot;</span>, provider, <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">for</span> (int8_t i = <a class="code" href="provider_8c.html#aa09a7ba5d2edcf32daab1f094eb07e77">MAX_PROV</a>-1; i &gt;= 0; i--) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].<a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> == NULL) {</div>
<div class="line">            <a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].name = <a class="code" href="provider_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line">            <a class="code" href="provider_8c.html#a45fd0d0b6c777a9452101f15c7e631b5">provs</a>[i].provider = <a class="code" href="provider_8c.html#a9cfb091f3898a26be41690ceec533d6d">provider</a>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adc1392ee6ef82e9fecb6e110eed65212"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void provider_set_default </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structprovider__t.html">provider_t</a> *&#160;</td>
          <td class="paramname"><em>prov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>epdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="provider_8c_source.html#l00206">206</a> of file <a class="el" href="provider_8c_source.html">provider.c</a>.</p>

<p>References <a class="el" href="provider_8h_source.html#l00058">endpoint_t::provdata</a>, and <a class="el" href="provider_8h_source.html#l00057">endpoint_t::provider</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00082">main()</a>.</p>
<div class="fragment"><div class="line">                                                          {</div>
<div class="line">    <a class="code" href="provider_8c.html#a210a908b8caea35007419c83e5d3c3e2">default_provider</a>.<a class="code" href="structendpoint__t.html#a9cfb091f3898a26be41690ceec533d6d">provider</a> = prov;</div>
<div class="line">    <a class="code" href="provider_8c.html#a210a908b8caea35007419c83e5d3c3e2">default_provider</a>.<a class="code" href="structendpoint__t.html#ad4e08597462bc0b0e400c3784397612d">provdata</a> = epdata;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="provider_8h_adc1392ee6ef82e9fecb6e110eed65212_icgraph.png" border="0" usemap="#provider_8h_adc1392ee6ef82e9fecb6e110eed65212_icgraph" alt=""/></div>
<map name="provider_8h_adc1392ee6ef82e9fecb6e110eed65212_icgraph" id="provider_8h_adc1392ee6ef82e9fecb6e110eed65212_icgraph">
<area shape="rect" id="node3" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="198,5,248,33"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 4 2012 04:34:52 for XD2031 firmware by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
