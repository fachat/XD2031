<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>XD2031 firmware: bus.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XD2031 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bus.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;config.h&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="status_8h_source.html">status.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="errormsg_8h_source.html">errormsg.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cmd_8h_source.html">cmd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cmd2_8h_source.html">cmd2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtconfig_8h_source.html">rtconfig.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bus_8h_source.html">bus.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="led_8h_source.html">led.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="debug_8h_source.html">debug.h</a>&quot;</code><br/>
<code>#include &quot;device.h&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bus.c:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c__incl.png" border="0" usemap="#bus_8c" alt=""/></div>
<map name="bus_8c" id="bus_8c">
<area shape="rect" id="node13" href="channel_8h.html" title="channel.h" alt="" coords="288,161,367,189"/><area shape="rect" id="node35" href="errormsg_8h.html" title="errormsg.h" alt="" coords="465,315,551,343"/><area shape="rect" id="node41" href="status_8h.html" title="status.h" alt="" coords="1027,83,1095,111"/><area shape="rect" id="node44" href="cmd_8h.html" title="cmd.h" alt="" coords="646,161,703,189"/><area shape="rect" id="node48" href="rtconfig_8h.html" title="rtconfig.h" alt="" coords="391,238,467,266"/><area shape="rect" id="node52" href="cmd2_8h.html" title="cmd2.h" alt="" coords="397,83,461,111"/><area shape="rect" id="node55" href="bus_8h.html" title="bus.h" alt="" coords="454,161,508,189"/><area shape="rect" id="node58" href="file_8h.html" title="file.h" alt="" coords="537,83,585,111"/><area shape="rect" id="node66" href="led_8h.html" title="led.h" alt="" coords="1119,83,1168,111"/><area shape="rect" id="node68" href="debug_8h.html" title="debug.h" alt="" coords="144,83,213,111"/><area shape="rect" id="node16" href="packet_8h.html" title="packet.h" alt="" coords="204,315,275,343"/><area shape="rect" id="node31" href="provider_8h.html" title="provider.h" alt="" coords="145,238,224,266"/><area shape="rect" id="node20" href="wireformat_8h.html" title="wireformat.h" alt="" coords="295,393,389,421"/><area shape="rect" id="node24" href="delay_8h.html" title="delay.h" alt="" coords="208,393,271,421"/><area shape="rect" id="node22" href="errors_8h.html" title="errors.h" alt="" coords="394,470,461,498"/><area shape="rect" id="node26" href="delayhw_8h.html" title="delayhw.h" alt="" coords="245,470,325,498"/><area shape="rect" id="node70" href="term_8h.html" title="term.h" alt="" coords="152,161,211,189"/><area shape="rect" id="node73" href="mem_8h.html" title="mem.h" alt="" coords="48,161,109,189"/></map>
</div>
</div>
<p><a href="bus_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a497e1deb19efa0b098119bddb4c0950d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a497e1deb19efa0b098119bddb4c0950d">bus_init</a> ()</td></tr>
<tr class="separator:a497e1deb19efa0b098119bddb4c0950d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7edc003edb7970966c57720ae8aa5d14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a7edc003edb7970966c57720ae8aa5d14">bus_init_bus</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>)</td></tr>
<tr class="separator:a7edc003edb7970966c57720ae8aa5d14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ba5b15cb16106a8060999ab65de737"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a66ba5b15cb16106a8060999ab65de737">_cmd_callback</a> (int8_t errnum, uint8_t *rxdata)</td></tr>
<tr class="separator:a66ba5b15cb16106a8060999ab65de737"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ec77741c71e9f01f346016e85f3e7b"><td class="memItemLeft" align="right" valign="top">static int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b">cmd_handler</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>)</td></tr>
<tr class="separator:a68ec77741c71e9f01f346016e85f3e7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a806cd6e423cc44a02552ed725d28ed7a"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a806cd6e423cc44a02552ed725d28ed7a">bus_sendbyte</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>, uint8_t data, uint8_t with_eoi)</td></tr>
<tr class="separator:a806cd6e423cc44a02552ed725d28ed7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab043e7626a61171d009fd5bec94ff7ec"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#ab043e7626a61171d009fd5bec94ff7ec">bus_receivebyte</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>, uint8_t *data, uint8_t preload)</td></tr>
<tr class="separator:ab043e7626a61171d009fd5bec94ff7ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c2d584fe64320bc811ffeb1d546b3f2"><td class="memItemLeft" align="right" valign="top">static int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a2c2d584fe64320bc811ffeb1d546b3f2">bus_prepare</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>)</td></tr>
<tr class="separator:a2c2d584fe64320bc811ffeb1d546b3f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa005573fc6338f79631c8fa5547b7cf5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#aa005573fc6338f79631c8fa5547b7cf5">bus_close</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>)</td></tr>
<tr class="separator:aa005573fc6338f79631c8fa5547b7cf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ec5bfd204977b488496697cc083664a"><td class="memItemLeft" align="right" valign="top">int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a5ec5bfd204977b488496697cc083664a">bus_attention</a> (<a class="el" href="structbus__t.html">bus_t</a> *<a class="el" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>, uint8_t b)</td></tr>
<tr class="separator:a5ec5bfd204977b488496697cc083664a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a208885b9d02f941e80cf70aaf666f46b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structerrormsg__t.html">errormsg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a></td></tr>
<tr class="separator:a208885b9d02f941e80cf70aaf666f46b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a5291db8a22e45b52ff38feb3bc731f"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a4a5291db8a22e45b52ff38feb3bc731f">secaddr_offset_counter</a></td></tr>
<tr class="separator:a4a5291db8a22e45b52ff38feb3bc731f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a567505b08ced37f3c29f8bd526703f84"><td class="memItemLeft" align="right" valign="top">static volatile <a class="el" href="structbus__t.html">bus_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a></td></tr>
<tr class="separator:a567505b08ced37f3c29f8bd526703f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a66ba5b15cb16106a8060999ab65de737"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void _cmd_callback </td>
          <td>(</td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>errnum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>rxdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00120">120</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8h_source.html#l00050">bus_t::cmd_done</a>, <a class="el" href="bus_8h_source.html#l00051">bus_t::errnum</a>, and <a class="el" href="bus_8h_source.html#l00052">bus_t::errparam</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00132">cmd_handler()</a>.</p>
<div class="fragment"><div class="line">                                                          {</div>
<div class="line">        <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a> = errnum;</div>
<div class="line">        <span class="keywordflow">if</span> (errnum == 1) {</div>
<div class="line">        <span class="keywordflow">if</span> (rxdata != NULL) {</div>
<div class="line">            <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#ac78a6fb6b51e958fe8d86aa630de39ef">errparam</a> = rxdata[1];</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#ac78a6fb6b51e958fe8d86aa630de39ef">errparam</a> = 0;</div>
<div class="line">        }</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#a6c90e63602903c46ce77f9a51c387135">cmd_done</a> = 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a66ba5b15cb16106a8060999ab65de737_icgraph.png" border="0" usemap="#bus_8c_a66ba5b15cb16106a8060999ab65de737_icgraph" alt=""/></div>
<map name="bus_8c_a66ba5b15cb16106a8060999ab65de737_icgraph" id="bus_8c_a66ba5b15cb16106a8060999ab65de737_icgraph">
<area shape="rect" id="node3" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="163,5,261,33"/><area shape="rect" id="node5" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="309,5,411,33"/><area shape="rect" id="node7" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="459,5,621,33"/><area shape="rect" id="node9" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="670,5,720,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5ec5bfd204977b488496697cc083664a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t bus_attention </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00359">359</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="led_8h_source.html#l00036">ACTIVE</a>, <a class="el" href="bus_8c_source.html#l00347">bus_close()</a>, <a class="el" href="bus_8c_source.html#l00308">bus_prepare()</a>, <a class="el" href="bus_8c_source.html#l00132">cmd_handler()</a>, <a class="el" href="bus_8h_source.html#l00040">bus_t::current_device_address</a>, <a class="el" href="debug_8h_source.html#l00041">debug_flush</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="bus_8h_source.html#l00046">bus_t::device</a>, <a class="el" href="led_8h_source.html#l00033">IDLE</a>, <a class="el" href="ledhw_8c_source.html#l00118">led_set()</a>, and <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>.</p>

<p>Referenced by <a class="el" href="ieee_8c_source.html#l00211">ieee_mainloop_iteration()</a>.</p>
<div class="fragment"><div class="line">                                             {</div>
<div class="line">    int16_t st = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// UNLISTEN and it is either open or the command channel</span></div>
<div class="line">    <span class="keywordflow">if</span> (b == 0x3f</div>
<div class="line">        &amp;&amp; (((bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0xf0) == 0xf0)</div>
<div class="line">            || ((bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f) == 0x0f))) {</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f) == bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line">        <span class="comment">// then process the command</span></div>
<div class="line">            st = <a class="code" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b">cmd_handler</a>(bus);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// not open, not command:</span></div>
<div class="line">        <span class="keywordflow">switch</span> (b &amp; 0xf0) {</div>
<div class="line">          <span class="keywordflow">case</span> 0x20:</div>
<div class="line">          <span class="keywordflow">case</span> 0x40:</div>
<div class="line">          <span class="comment">// store device number plus LISTEN/TALK info</span></div>
<div class="line">          <span class="keywordflow">if</span> ((b &amp; 0x0f) == bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line">                bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> = b;</div>
<div class="line">          }</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">case</span> 0x60:</div>
<div class="line">          <span class="comment">// secondary address (open DATA channel)</span></div>
<div class="line">          <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f) == bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line"></div>
<div class="line">                bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> = b;</div>
<div class="line">            <span class="comment">// process a command if necessary</span></div>
<div class="line">                <a class="code" href="bus_8c.html#a2c2d584fe64320bc811ffeb1d546b3f2">bus_prepare</a>(bus);</div>
<div class="line">          }</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">          <span class="keywordflow">case</span> 0xe0:</div>
<div class="line">          <span class="comment">// secondary address (CLOSE)</span></div>
<div class="line">          <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f) == bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line">                bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> = b;</div>
<div class="line">            <span class="comment">// process a command if necessary</span></div>
<div class="line">                <span class="comment">//st = bus_command(bus);</span></div>
<div class="line">                <a class="code" href="bus_8c.html#aa005573fc6338f79631c8fa5547b7cf5">bus_close</a>(bus);</div>
<div class="line">          }</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">case</span> 0xf0:            <span class="comment">/* Open File needs the filename first */</span></div>
<div class="line">          <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f) == bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line">                bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> = b;</div>
<div class="line">            <span class="comment">// TODO: close previously opened file</span></div>
<div class="line">          }</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="comment">// falls through e.g. for unlisten/untalk</span></div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((b == 0x3f) || (b == 0x5f) || ((b &amp; 0xf0) == 0xe0)) {</div>
<div class="line">    <span class="comment">// unlisten, untalk, close</span></div>
<div class="line">        bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> = 0;</div>
<div class="line">        bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8">led_set</a>(<a class="code" href="led_8h.html#a846377e6d942664081c5b04f3485db04afd6a0e4343048b10646dd2976cc5ad18">IDLE</a>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a> != (bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f)) {</div>
<div class="line">        <span class="comment">// not this device</span></div>
<div class="line">            st |= 0x80;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8">led_set</a>(<a class="code" href="led_8h.html#a846377e6d942664081c5b04f3485db04a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a>);</div>
<div class="line">    }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;ParallelAttention(%02x)-&gt;TrapDevice=%02x, st=%04x\n&quot;</span>,</div>
<div class="line">               b, bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a>, st | (bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &lt;&lt; 8));</div>
<div class="line">    <a class="code" href="debug_8h.html#a341c655e62477257e0e36ddecf00e2d3">debug_flush</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    st |= bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &lt;&lt; 8;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> st;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a5ec5bfd204977b488496697cc083664a_cgraph.png" border="0" usemap="#bus_8c_a5ec5bfd204977b488496697cc083664a_cgraph" alt=""/></div>
<map name="bus_8c_a5ec5bfd204977b488496697cc083664a_cgraph" id="bus_8c_a5ec5bfd204977b488496697cc083664a_cgraph">
<area shape="rect" id="node3" href="bus_8c.html#aa005573fc6338f79631c8fa5547b7cf5" title="bus_close" alt="" coords="327,626,409,654"/><area shape="rect" id="node32" href="bus_8c.html#a2c2d584fe64320bc811ffeb1d546b3f2" title="bus_prepare" alt="" coords="156,394,252,422"/><area shape="rect" id="node46" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="1124,1545,1188,1573"/><area shape="rect" id="node96" href="bus_8c.html#a68ec77741c71e9f01f346016e85f3e7b" title="cmd_handler" alt="" coords="155,717,253,745"/><area shape="rect" id="node5" href="channel_8c.html#a95267ccd8b077002647dcf947cccbb4d" title="channel_close_range" alt="" coords="693,779,841,807"/><area shape="rect" id="node13" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4" title="bus_secaddr_adjust" alt="" coords="492,470,633,498"/><area shape="rect" id="node15" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="713,650,820,678"/><area shape="rect" id="node7" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="1108,755,1204,783"/><area shape="rect" id="node9" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="905,779,1033,807"/><area shape="rect" id="node11" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="1113,857,1199,885"/><area shape="rect" id="node18" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="934,367,1005,395"/><area shape="rect" id="node22" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="892,625,1047,653"/><area shape="rect" id="node24" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="1096,521,1216,549"/><area shape="rect" id="node28" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="913,573,1026,601"/><area shape="rect" id="node20" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="1110,394,1202,422"/><area shape="rect" id="node26" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="1264,521,1384,549"/><area shape="rect" id="node36" href="bus_8c.html#ab043e7626a61171d009fd5bec94ff7ec" title="bus_receivebyte" alt="" coords="309,290,427,318"/><area shape="rect" id="node38" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="729,1035,804,1063"/><area shape="rect" id="node54" href="channel_8c.html#ac42b73ef4fb417f5eae59ce4bcc34da1" title="channel_preloadp" alt="" coords="499,213,626,241"/><area shape="rect" id="node66" href="channel_8c.html#ab251327a6bfb5495a6f0c4e86b2b4a6d" title="channel_current_byte" alt="" coords="488,161,637,189"/><area shape="rect" id="node71" href="channel_8h.html#a67933e90bf107059d7c8b99b303414e6" title="channel_current_is_eof" alt="" coords="483,31,643,59"/><area shape="rect" id="node75" href="channel_8c.html#ab788bfc67eced677c3e8f3b5f4c25d9c" title="channel_next" alt="" coords="512,109,613,137"/><area shape="rect" id="node82" href="channel_8c.html#a36f99405322341c5ec6190ad7df984e8" title="channel_has_more" alt="" coords="495,265,630,293"/><area shape="rect" id="node87" href="channel_8c.html#a5eb3ce54c85a9984a99446a4bd7cc180" title="channel_refill" alt="" coords="717,367,817,395"/><area shape="rect" id="node40" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="923,1493,1016,1521"/><area shape="rect" id="node42" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="1100,1493,1212,1521"/><area shape="rect" id="node44" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="1110,1441,1202,1469"/><area shape="rect" id="node48" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="1290,1545,1358,1573"/><area shape="rect" id="node50" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="1290,1597,1358,1625"/><area shape="rect" id="node52" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="1291,1493,1357,1521"/><area shape="rect" id="node56" href="channel_8c.html#ae7784dd177e78324ea066e9a2e475737" title="channel_preload_int" alt="" coords="696,263,837,291"/><area shape="rect" id="node58" href="channel_8c.html#ad83a55f9935cdd471dc212f4ec6c7a6d" title="channel_pull" alt="" coords="921,211,1017,239"/><area shape="rect" id="node62" href="packet_8h.html#addb176aaaeddd33017a9c51693dc4510" title="packet_has_data" alt="" coords="908,315,1031,343"/><area shape="rect" id="node64" href="packet_8h.html#a23092de9747c65e9bbbe4516a23056a0" title="packet_is_last" alt="" coords="916,263,1022,291"/><area shape="rect" id="node69" href="packet_8h.html#a3a738b87a4697d5c841bbac110b4fc75" title="packet_peek_data" alt="" coords="702,211,832,239"/><area shape="rect" id="node73" href="packet_8h.html#a477da849971659985201df01c17bb864" title="packet_current_is_eof" alt="" coords="690,5,843,33"/><area shape="rect" id="node80" href="packet_8h.html#a4cb17d0b158d95f2c9fc566c88a6a48d" title="packet_next" alt="" coords="720,159,813,187"/><area shape="rect" id="node85" href="packet_8h.html#a20bc11a9cb93f05ea36f126d3e44086e" title="packet_is_eof" alt="" coords="715,315,818,343"/><area shape="rect" id="node98" href="cmd_8c.html#abaf24aaeaa145dec95026ae71251be71" title="command_execute" alt="" coords="301,1035,435,1063"/><area shape="rect" id="node126" href="bus_8c.html#a66ba5b15cb16106a8060999ab65de737" title="_cmd_callback" alt="" coords="313,678,423,706"/><area shape="rect" id="node128" href="file_8c.html#a2dac9b9090b14532b84f96929c3cb2cc" title="file_open" alt="" coords="330,1187,406,1215"/><area shape="rect" id="node140" href="channel_8c.html#a0e2a982477e7730e6d25854edd31a259" title="channel_preload" alt="" coords="503,522,623,550"/><area shape="rect" id="node100" href="name_8c.html#a0e25b9dc05d9d0c2b58510892dacd5eb" title="parse_filename" alt="" coords="506,1290,619,1318"/><area shape="rect" id="node102" href="cmd_8c.html#a638fac6ce8a134b11f8b5f8858af1e0a" title="command_to_name" alt="" coords="697,1393,836,1421"/><area shape="rect" id="node104" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2" title="debug_putcrlf" alt="" coords="716,1251,818,1279"/><area shape="rect" id="node106" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d" title="debug_putc" alt="" coords="721,1174,812,1202"/><area shape="rect" id="node112" href="file_8c.html#a8336bd2f1ed40fc3520412402061d43b" title="file_submit_call" alt="" coords="506,983,619,1011"/><area shape="rect" id="node121" href="provider_8c.html#a2fb3453f8017a7e05b4b0a0a1f7e9203" title="provider_assign" alt="" coords="505,879,620,907"/><area shape="rect" id="node123" href="rtconfig_8c.html#a213b60e4a3e31791a44d45ff8e867905" title="rtconfig_set" alt="" coords="518,931,608,959"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a5ec5bfd204977b488496697cc083664a_icgraph.png" border="0" usemap="#bus_8c_a5ec5bfd204977b488496697cc083664a_icgraph" alt=""/></div>
<map name="bus_8c_a5ec5bfd204977b488496697cc083664a_icgraph" id="bus_8c_a5ec5bfd204977b488496697cc083664a_icgraph">
<area shape="rect" id="node3" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="155,5,317,33"/><area shape="rect" id="node5" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="366,5,416,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa005573fc6338f79631c8fa5547b7cf5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void bus_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00347">347</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8h_source.html#l00078">bus_secaddr_adjust()</a>, <a class="el" href="channel_8c_source.html#l00250">channel_close()</a>, <a class="el" href="channel_8c_source.html#l00386">channel_close_range()</a>, and <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00359">bus_attention()</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">        uint8_t secaddr = bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f;</div>
<div class="line">          <span class="comment">/* Close File */</span></div>
<div class="line">          <span class="keywordflow">if</span>(secaddr == 15) {</div>
<div class="line">        <span class="comment">// is this correct or only a convenience?</span></div>
<div class="line">            <a class="code" href="channel_8c.html#a95267ccd8b077002647dcf947cccbb4d">channel_close_range</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, 0), <a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, 15));</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Close a single buffer */</span></div>
<div class="line">            <a class="code" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b">channel_close</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr));</div>
<div class="line">          }</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_cgraph.png" border="0" usemap="#bus_8c_aa005573fc6338f79631c8fa5547b7cf5_cgraph" alt=""/></div>
<map name="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_cgraph" id="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_cgraph">
<area shape="rect" id="node3" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4" title="bus_secaddr_adjust" alt="" coords="140,5,281,33"/><area shape="rect" id="node5" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="157,161,264,189"/><area shape="rect" id="node26" href="channel_8c.html#a95267ccd8b077002647dcf947cccbb4d" title="channel_close_range" alt="" coords="137,57,285,85"/><area shape="rect" id="node7" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="550,161,647,189"/><area shape="rect" id="node9" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="377,317,447,345"/><area shape="rect" id="node13" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="334,109,490,137"/><area shape="rect" id="node15" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="352,265,472,293"/><area shape="rect" id="node19" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="355,161,469,189"/><area shape="rect" id="node22" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="348,57,476,85"/><area shape="rect" id="node11" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="552,317,645,345"/><area shape="rect" id="node17" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="539,265,659,293"/><area shape="rect" id="node24" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="556,57,641,85"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_icgraph.png" border="0" usemap="#bus_8c_aa005573fc6338f79631c8fa5547b7cf5_icgraph" alt=""/></div>
<map name="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_icgraph" id="bus_8c_aa005573fc6338f79631c8fa5547b7cf5_icgraph">
<area shape="rect" id="node3" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="136,5,237,33"/><area shape="rect" id="node5" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="285,5,448,33"/><area shape="rect" id="node7" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="496,5,546,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a497e1deb19efa0b098119bddb4c0950d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bus_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00087">87</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="errors_8h_source.html#l00068">ERROR_DOSVERSION</a>, <a class="el" href="bus_8c_source.html#l00085">secaddr_offset_counter</a>, and <a class="el" href="errormsg_8h_source.html#l00052">set_error()</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00082">main()</a>.</p>
<div class="fragment"><div class="line">                {</div>
<div class="line">    <a class="code" href="bus_8c.html#a4a5291db8a22e45b52ff38feb3bc731f">secaddr_offset_counter</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629abb4b5c13368f174e39b6cfbb8192c9c3">ERROR_DOSVERSION</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a497e1deb19efa0b098119bddb4c0950d_cgraph.png" border="0" usemap="#bus_8c_a497e1deb19efa0b098119bddb4c0950d_cgraph" alt=""/></div>
<map name="bus_8c_a497e1deb19efa0b098119bddb4c0950d_cgraph" id="bus_8c_a497e1deb19efa0b098119bddb4c0950d_cgraph">
<area shape="rect" id="node3" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="120,57,195,85"/><area shape="rect" id="node5" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="243,57,336,85"/><area shape="rect" id="node7" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="384,5,496,33"/><area shape="rect" id="node9" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="394,57,486,85"/><area shape="rect" id="node11" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="408,109,472,137"/><area shape="rect" id="node13" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="544,57,613,85"/><area shape="rect" id="node15" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="544,109,613,137"/><area shape="rect" id="node17" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="546,161,611,189"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a497e1deb19efa0b098119bddb4c0950d_icgraph.png" border="0" usemap="#bus_8c_a497e1deb19efa0b098119bddb4c0950d_icgraph" alt=""/></div>
<map name="bus_8c_a497e1deb19efa0b098119bddb4c0950d_icgraph" id="bus_8c_a497e1deb19efa0b098119bddb4c0950d_icgraph">
<area shape="rect" id="node3" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="120,5,170,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7edc003edb7970966c57720ae8aa5d14"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bus_init_bus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00094">94</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8h_source.html#l00044">bus_t::channel</a>, <a class="el" href="bus_8h_source.html#l00055">bus_t::command</a>, <a class="el" href="cmd_8h_source.html#l00075">cmd_t::command_length</a>, <a class="el" href="bus_8h_source.html#l00040">bus_t::current_device_address</a>, <a class="el" href="bus_8h_source.html#l00059">bus_t::rtconf</a>, <a class="el" href="rtconfig_8c_source.html#l00038">rtconfig_init()</a>, <a class="el" href="bus_8h_source.html#l00041">bus_t::secaddr_offset</a>, and <a class="el" href="bus_8c_source.html#l00085">secaddr_offset_counter</a>.</p>

<p>Referenced by <a class="el" href="ieee_8c_source.html#l00298">ieeehwi_init()</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line"></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#aa3ad1aa3592f133b39225c2c64b663a2">secaddr_offset</a> = <a class="code" href="bus_8c.html#a4a5291db8a22e45b52ff38feb3bc731f">secaddr_offset_counter</a>;</div>
<div class="line">    <a class="code" href="bus_8c.html#a4a5291db8a22e45b52ff38feb3bc731f">secaddr_offset_counter</a> += 16;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read the hardware-set device address */</span></div>
<div class="line">    <span class="comment">//  device_address = device_hw_address();</span></div>
<div class="line">    uint8_t devaddr = 8;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Init vars and flags */</span></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a5ce40446fcd0f4c16af5ea0f16ff7adb">command_length</a> = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// this is copied over after an UNTALK/UNLISTEN</span></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a> = devaddr;</div>
<div class="line">    <a class="code" href="rtconfig_8c.html#a6f1986b4e174ef8a8d121e021d1abead">rtconfig_init</a>(&amp;(bus-&gt;<a class="code" href="structbus__t.html#ac294eee916103f1c1f9700b1d39e1f90">rtconf</a>), devaddr);</div>
<div class="line"></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> = NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a7edc003edb7970966c57720ae8aa5d14_cgraph.png" border="0" usemap="#bus_8c_a7edc003edb7970966c57720ae8aa5d14_cgraph" alt=""/></div>
<map name="bus_8c_a7edc003edb7970966c57720ae8aa5d14_cgraph" id="bus_8c_a7edc003edb7970966c57720ae8aa5d14_cgraph">
<area shape="rect" id="node3" href="rtconfig_8c.html#a6f1986b4e174ef8a8d121e021d1abead" title="rtconfig_init" alt="" coords="150,5,239,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a7edc003edb7970966c57720ae8aa5d14_icgraph.png" border="0" usemap="#bus_8c_a7edc003edb7970966c57720ae8aa5d14_icgraph" alt=""/></div>
<map name="bus_8c_a7edc003edb7970966c57720ae8aa5d14_icgraph" id="bus_8c_a7edc003edb7970966c57720ae8aa5d14_icgraph">
<area shape="rect" id="node3" href="ieee_8h.html#ad6695d7d596b8224f60a073159b9a39a" title="ieeehwi_init" alt="" coords="149,5,240,33"/><area shape="rect" id="node5" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="288,5,338,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c2d584fe64320bc811ffeb1d546b3f2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int16_t bus_prepare </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00308">308</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8c_source.html#l00242">bus_receivebyte()</a>, <a class="el" href="bus_8h_source.html#l00078">bus_secaddr_adjust()</a>, <a class="el" href="bus_8h_source.html#l00044">bus_t::channel</a>, <a class="el" href="channel_8c_source.html#l00127">channel_find()</a>, <a class="el" href="bus_8h_source.html#l00040">bus_t::current_device_address</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="bus_8h_source.html#l00046">bus_t::device</a>, and <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00359">bus_attention()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    uint8_t b;</div>
<div class="line">    int8_t secaddr;</div>
<div class="line">    <span class="keywordtype">int</span> st = 0;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;***ParallelCommand %02x %02x\n&quot;</span>,</div>
<div class="line">         bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a>, bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0x0f) != bus-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 0x80;    <span class="comment">// device not present</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    secaddr = bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (secaddr != 15) {</div>
<div class="line">            <span class="comment">/* Open Channel */</span></div>
<div class="line">        bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> = <a class="code" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df">channel_find</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr));</div>
<div class="line">        <span class="keywordflow">if</span> (bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> == NULL) {</div>
<div class="line">            <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;Did not find channel!\n&quot;</span>);</div>
<div class="line">            st |= 0x40; <span class="comment">// TODO correct code?</span></div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">          <span class="keywordflow">if</span> ((bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &amp; 0xf0) == 0x40) {</div>
<div class="line">            <span class="comment">// if we should TALK, prepare the first data byte</span></div>
<div class="line">            <span class="keywordflow">if</span> (!st) {</div>
<div class="line">                    st = <a class="code" href="bus_8c.html#ab043e7626a61171d009fd5bec94ff7ec">bus_receivebyte</a>(bus, &amp;b, 1) &amp; 0xbf;   <span class="comment">/* any error, except eof */</span></div>
<div class="line">            <span class="comment">//debug_printf(&quot;receive gets st=%04x\n&quot;, st);</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// cause a FILE NOT FOUND</span></div>
<div class="line">            <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;FILE NOT FOUND\n&quot;</span>);</div>
<div class="line">            bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> = 0;</div>
<div class="line">        }</div>
<div class="line">          }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_cgraph.png" border="0" usemap="#bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_cgraph" alt=""/></div>
<map name="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_cgraph" id="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_cgraph">
<area shape="rect" id="node3" href="bus_8c.html#ab043e7626a61171d009fd5bec94ff7ec" title="bus_receivebyte" alt="" coords="150,470,269,498"/><area shape="rect" id="node33" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="1110,250,1207,278"/><area shape="rect" id="node85" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4" title="bus_secaddr_adjust" alt="" coords="327,678,468,706"/><area shape="rect" id="node5" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="360,185,435,213"/><area shape="rect" id="node21" href="channel_8c.html#ac42b73ef4fb417f5eae59ce4bcc34da1" title="channel_preloadp" alt="" coords="334,574,461,602"/><area shape="rect" id="node43" href="channel_8c.html#ab251327a6bfb5495a6f0c4e86b2b4a6d" title="channel_current_byte" alt="" coords="323,522,472,550"/><area shape="rect" id="node48" href="channel_8h.html#a67933e90bf107059d7c8b99b303414e6" title="channel_current_is_eof" alt="" coords="317,366,477,394"/><area shape="rect" id="node52" href="channel_8c.html#ab788bfc67eced677c3e8f3b5f4c25d9c" title="channel_next" alt="" coords="347,626,448,654"/><area shape="rect" id="node59" href="channel_8c.html#a36f99405322341c5ec6190ad7df984e8" title="channel_has_more" alt="" coords="330,470,465,498"/><area shape="rect" id="node64" href="channel_8c.html#a5eb3ce54c85a9984a99446a4bd7cc180" title="channel_refill" alt="" coords="551,418,651,446"/><area shape="rect" id="node74" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="548,314,655,342"/><area shape="rect" id="node7" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="555,133,648,161"/><area shape="rect" id="node9" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="748,158,860,186"/><area shape="rect" id="node11" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="758,54,850,82"/><area shape="rect" id="node13" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="772,106,836,134"/><area shape="rect" id="node15" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="956,106,1025,134"/><area shape="rect" id="node17" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="956,158,1025,186"/><area shape="rect" id="node19" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="958,54,1023,82"/><area shape="rect" id="node23" href="channel_8c.html#ae7784dd177e78324ea066e9a2e475737" title="channel_preload_int" alt="" coords="531,574,672,602"/><area shape="rect" id="node25" href="channel_8c.html#ad83a55f9935cdd471dc212f4ec6c7a6d" title="channel_pull" alt="" coords="756,574,852,602"/><area shape="rect" id="node35" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="769,470,839,498"/><area shape="rect" id="node39" href="packet_8h.html#addb176aaaeddd33017a9c51693dc4510" title="packet_has_data" alt="" coords="743,522,865,550"/><area shape="rect" id="node41" href="packet_8h.html#a23092de9747c65e9bbbe4516a23056a0" title="packet_is_last" alt="" coords="751,626,857,654"/><area shape="rect" id="node27" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="930,522,1051,550"/><area shape="rect" id="node31" href="channel_8c.html#a26b97d3a3a80ba21ae3d74944fc3477e" title="_pull_callback" alt="" coords="938,574,1043,602"/><area shape="rect" id="node29" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="1099,522,1219,550"/><area shape="rect" id="node37" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="944,470,1037,498"/><area shape="rect" id="node46" href="packet_8h.html#a3a738b87a4697d5c841bbac110b4fc75" title="packet_peek_data" alt="" coords="536,522,666,550"/><area shape="rect" id="node50" href="packet_8h.html#a477da849971659985201df01c17bb864" title="packet_current_is_eof" alt="" coords="525,366,678,394"/><area shape="rect" id="node57" href="packet_8h.html#a4cb17d0b158d95f2c9fc566c88a6a48d" title="packet_next" alt="" coords="555,678,648,706"/><area shape="rect" id="node62" href="packet_8h.html#a20bc11a9cb93f05ea36f126d3e44086e" title="packet_is_eof" alt="" coords="550,470,653,498"/><area shape="rect" id="node70" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="740,366,868,394"/><area shape="rect" id="node72" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="948,366,1033,394"/><area shape="rect" id="node78" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="726,262,882,290"/><area shape="rect" id="node81" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="934,289,1047,317"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_icgraph.png" border="0" usemap="#bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_icgraph" alt=""/></div>
<map name="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_icgraph" id="bus_8c_a2c2d584fe64320bc811ffeb1d546b3f2_icgraph">
<area shape="rect" id="node3" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="149,5,251,33"/><area shape="rect" id="node5" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="299,5,461,33"/><area shape="rect" id="node7" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="510,5,560,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab043e7626a61171d009fd5bec94ff7ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t bus_receivebyte </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>preload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00242">242</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8h_source.html#l00078">bus_secaddr_adjust()</a>, <a class="el" href="bus_8h_source.html#l00044">bus_t::channel</a>, <a class="el" href="channel_8c_source.html#l00250">channel_close()</a>, <a class="el" href="channel_8c_source.html#l00199">channel_current_byte()</a>, <a class="el" href="channel_8h_source.html#l00114">channel_current_is_eof()</a>, <a class="el" href="channel_8c_source.html#l00232">channel_has_more()</a>, <a class="el" href="channel_8c_source.html#l00207">channel_next()</a>, <a class="el" href="channel_8c_source.html#l00195">channel_preloadp()</a>, <a class="el" href="channel_8c_source.html#l00287">channel_refill()</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="debug_8h_source.html#l00042">debug_puts</a>, <a class="el" href="bus_8h_source.html#l00046">bus_t::device</a>, <a class="el" href="errormsg_8h_source.html#l00046">errormsg_t::error_buffer</a>, <a class="el" href="errors_8h_source.html#l00057">ERROR_FILE_NOT_OPEN</a>, <a class="el" href="errors_8h_source.html#l00038">ERROR_OK</a>, <a class="el" href="errormsg_8h_source.html#l00047">errormsg_t::readp</a>, <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>, and <a class="el" href="errormsg_8h_source.html#l00052">set_error()</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00308">bus_prepare()</a>, and <a class="el" href="ieee_8c_source.html#l00121">talkloop()</a>.</p>
<div class="fragment"><div class="line">                                                                    {</div>
<div class="line"></div>
<div class="line">    int16_t st = 0;</div>
<div class="line"></div>
<div class="line">    uint8_t secaddr = bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f;</div>
<div class="line">    <a class="code" href="structchannel__t.html">channel_t</a> *channel = bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (secaddr == 15) {</div>
<div class="line"></div>
<div class="line">        *data = <a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#ad6c46b082171b63027d56123d814c804">error_buffer</a>[<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#a015c9677b918693f8476778fca0adc31">readp</a>];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#ad6c46b082171b63027d56123d814c804">error_buffer</a>[<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#a015c9677b918693f8476778fca0adc31">readp</a>+1] == 0) {</div>
<div class="line">            <span class="comment">// send EOF</span></div>
<div class="line">            st |= 0x40;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!preload) {</div>
<div class="line">            <span class="comment">// the real thing</span></div>
<div class="line">            <a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#a015c9677b918693f8476778fca0adc31">readp</a>++;</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#ad6c46b082171b63027d56123d814c804">error_buffer</a>[<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>.<a class="code" href="structerrormsg__t.html#a015c9677b918693f8476778fca0adc31">readp</a>] == 0) {</div>
<div class="line">                <span class="comment">// finished reading the error message</span></div>
<div class="line">                <span class="comment">// set OK</span></div>
<div class="line">                <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629aadeb5032c03491611646c1c64f7c0e0c">ERROR_OK</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (channel == NULL) {</div>
<div class="line">        <span class="comment">// if still NULL, error</span></div>
<div class="line">        <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Setting file not open on secaddr %d\n&quot;</span>, bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629a99f4b65bd2abbc06bc0492ab31e23432">ERROR_FILE_NOT_OPEN</a>);</div>
<div class="line">        st = 0x83;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">//debug_printf(&quot;rx: chan=%p, channo=%d\n&quot;, channel, channel-&gt;channel_no);</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">// first fillup the buffers</span></div>
<div class="line">        <a class="code" href="channel_8c.html#ac42b73ef4fb417f5eae59ce4bcc34da1">channel_preloadp</a>(channel);</div>
<div class="line"></div>
<div class="line">        *data = <a class="code" href="channel_8c.html#ab251327a6bfb5495a6f0c4e86b2b4a6d">channel_current_byte</a>(channel);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a67933e90bf107059d7c8b99b303414e6">channel_current_is_eof</a>(channel)) {</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>            <a class="code" href="debug_8h.html#af1318f845116bd417e969fa7c340ff36">debug_puts</a>(<span class="stringliteral">&quot;EOF!\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            st |= 0x40;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!preload) {</div>
<div class="line">            <span class="comment">// make sure the next call does have a data byte</span></div>
<div class="line">            <span class="keywordflow">if</span> (!<a class="code" href="channel_8c.html#ab788bfc67eced677c3e8f3b5f4c25d9c">channel_next</a>(channel)) {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#a36f99405322341c5ec6190ad7df984e8">channel_has_more</a>(channel)) {</div>
<div class="line">                    <a class="code" href="channel_8c.html#a5eb3ce54c85a9984a99446a4bd7cc180">channel_refill</a>(channel);</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (secaddr == 15 || secaddr == 0) {</div>
<div class="line">                            <span class="comment">// autoclose when load is done, or after reading status channel</span></div>
<div class="line">                        <a class="code" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b">channel_close</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr));</div>
<div class="line">                        bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> = NULL;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> st + (bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &lt;&lt; 8);</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_cgraph.png" border="0" usemap="#bus_8c_ab043e7626a61171d009fd5bec94ff7ec_cgraph" alt=""/></div>
<map name="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_cgraph" id="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_cgraph">
<area shape="rect" id="node3" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4" title="bus_secaddr_adjust" alt="" coords="183,31,324,59"/><area shape="rect" id="node5" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="404,82,511,110"/><area shape="rect" id="node26" href="channel_8c.html#ab251327a6bfb5495a6f0c4e86b2b4a6d" title="channel_current_byte" alt="" coords="179,238,328,266"/><area shape="rect" id="node43" href="channel_8h.html#a67933e90bf107059d7c8b99b303414e6" title="channel_current_is_eof" alt="" coords="173,186,333,214"/><area shape="rect" id="node47" href="channel_8c.html#a36f99405322341c5ec6190ad7df984e8" title="channel_has_more" alt="" coords="186,290,321,318"/><area shape="rect" id="node52" href="channel_8c.html#ab788bfc67eced677c3e8f3b5f4c25d9c" title="channel_next" alt="" coords="203,394,304,422"/><area shape="rect" id="node59" href="channel_8c.html#ac42b73ef4fb417f5eae59ce4bcc34da1" title="channel_preloadp" alt="" coords="190,342,317,370"/><area shape="rect" id="node62" href="channel_8c.html#a5eb3ce54c85a9984a99446a4bd7cc180" title="channel_refill" alt="" coords="407,134,507,162"/><area shape="rect" id="node69" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="216,498,291,526"/><area shape="rect" id="node7" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="966,82,1063,110"/><area shape="rect" id="node9" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="625,238,695,266"/><area shape="rect" id="node13" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="582,30,738,58"/><area shape="rect" id="node15" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="786,290,907,318"/><area shape="rect" id="node19" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="790,82,903,110"/><area shape="rect" id="node22" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="596,134,724,162"/><area shape="rect" id="node11" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="800,238,893,266"/><area shape="rect" id="node17" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="955,290,1075,318"/><area shape="rect" id="node24" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="804,134,889,162"/><area shape="rect" id="node28" href="channel_8c.html#ae7784dd177e78324ea066e9a2e475737" title="channel_preload_int" alt="" coords="387,342,528,370"/><area shape="rect" id="node41" href="packet_8h.html#a3a738b87a4697d5c841bbac110b4fc75" title="packet_peek_data" alt="" coords="392,238,522,266"/><area shape="rect" id="node30" href="channel_8c.html#ad83a55f9935cdd471dc212f4ec6c7a6d" title="channel_pull" alt="" coords="612,342,708,370"/><area shape="rect" id="node37" href="packet_8h.html#addb176aaaeddd33017a9c51693dc4510" title="packet_has_data" alt="" coords="599,290,721,318"/><area shape="rect" id="node39" href="packet_8h.html#a23092de9747c65e9bbbe4516a23056a0" title="packet_is_last" alt="" coords="607,394,713,422"/><area shape="rect" id="node33" href="channel_8c.html#a26b97d3a3a80ba21ae3d74944fc3477e" title="_pull_callback" alt="" coords="794,342,899,370"/><area shape="rect" id="node45" href="packet_8h.html#a477da849971659985201df01c17bb864" title="packet_current_is_eof" alt="" coords="381,186,534,214"/><area shape="rect" id="node50" href="packet_8h.html#a20bc11a9cb93f05ea36f126d3e44086e" title="packet_is_eof" alt="" coords="406,290,509,318"/><area shape="rect" id="node57" href="packet_8h.html#a4cb17d0b158d95f2c9fc566c88a6a48d" title="packet_next" alt="" coords="411,497,504,525"/><area shape="rect" id="node71" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="411,549,504,577"/><area shape="rect" id="node73" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="604,497,716,525"/><area shape="rect" id="node75" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="614,549,706,577"/><area shape="rect" id="node77" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="628,601,692,629"/><area shape="rect" id="node79" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="812,549,881,577"/><area shape="rect" id="node81" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="812,601,881,629"/><area shape="rect" id="node83" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="814,653,879,681"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_icgraph.png" border="0" usemap="#bus_8c_ab043e7626a61171d009fd5bec94ff7ec_icgraph" alt=""/></div>
<map name="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_icgraph" id="bus_8c_ab043e7626a61171d009fd5bec94ff7ec_icgraph">
<area shape="rect" id="node3" href="bus_8c.html#a2c2d584fe64320bc811ffeb1d546b3f2" title="bus_prepare" alt="" coords="173,5,269,33"/><area shape="rect" id="node11" href="ieee_8c.html#aab59fb97f896fd24eb381d95aef1f098" title="talkloop" alt="" coords="334,57,402,85"/><area shape="rect" id="node5" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="317,5,419,33"/><area shape="rect" id="node7" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="467,31,629,59"/><area shape="rect" id="node9" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="678,31,728,59"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a806cd6e423cc44a02552ed725d28ed7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int16_t bus_sendbyte </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>with_eoi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00218">218</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8h_source.html#l00044">bus_t::channel</a>, <a class="el" href="channel_8c_source.html#l00348">channel_put()</a>, <a class="el" href="bus_8h_source.html#l00055">bus_t::command</a>, <a class="el" href="cmd_8h_source.html#l00077">cmd_t::command_buffer</a>, <a class="el" href="cmd_8h_source.html#l00075">cmd_t::command_length</a>, <a class="el" href="pet_s_d_2config_8h_source.html#l00040">CONFIG_COMMAND_BUFFER_SIZE</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="bus_8h_source.html#l00046">bus_t::device</a>, and <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>.</p>

<p>Referenced by <a class="el" href="ieee_8c_source.html#l00103">listenloop()</a>.</p>
<div class="fragment"><div class="line">                                                                 {</div>
<div class="line"></div>
<div class="line">    int16_t st = 0;</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL_DATA</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;sendbyte: %02x (%c)\n&quot;</span>, data, (isprint(data) ? data : <span class="charliteral">&#39;-&#39;</span>));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span>((bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f) == 0x0f || (bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0xf0) == 0xf0) {</div>
<div class="line">      <span class="keywordflow">if</span> (bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a5ce40446fcd0f4c16af5ea0f16ff7adb">command_length</a> &lt; <a class="code" href="pet_s_d_2config_8h.html#ae06c64cb4f9205b702dfacc8dd4726b2">CONFIG_COMMAND_BUFFER_SIZE</a>) {</div>
<div class="line">        bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a34c46fd8deb58b66521af86b4d3d4fd9">command_buffer</a>[bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a5ce40446fcd0f4c16af5ea0f16ff7adb">command_length</a>++] = data;</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> = <a class="code" href="channel_8c.html#a5bfb7b380fbcb047cb5b839823ed019d">channel_put</a>(bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a>, data, with_eoi);</div>
<div class="line">      <span class="keywordflow">if</span> (bus-&gt;<a class="code" href="structbus__t.html#a660bf66adad2484288e40d15cec8c09a">channel</a> == NULL) {</div>
<div class="line">    st = 0x83;  <span class="comment">// TODO correct code</span></div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> st + (bus-&gt;<a class="code" href="structbus__t.html#a2376f17d1e7367401184b2a3978bcd3a">device</a> &lt;&lt; 8);</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_cgraph.png" border="0" usemap="#bus_8c_a806cd6e423cc44a02552ed725d28ed7a_cgraph" alt=""/></div>
<map name="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_cgraph" id="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_cgraph">
<area shape="rect" id="node3" href="channel_8c.html#a5bfb7b380fbcb047cb5b839823ed019d" title="channel_put" alt="" coords="157,161,251,189"/><area shape="rect" id="node5" href="packet_8h.html#a16bdf2f8eaed2ccf4712247bc5866e7f" title="packet_write_char" alt="" coords="313,5,442,33"/><area shape="rect" id="node7" href="packet_8h.html#a7ec26bfc3c2a75c12b2ed9a8d12b5daf" title="packet_is_full" alt="" coords="326,57,428,85"/><area shape="rect" id="node9" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="317,109,438,137"/><area shape="rect" id="node13" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="300,161,455,189"/><area shape="rect" id="node15" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="342,213,413,241"/><area shape="rect" id="node19" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="321,265,434,293"/><area shape="rect" id="node23" href="packet_8h.html#ad61c5a329d6379bd96faf0a29b1b565f" title="packet_reset" alt="" coords="328,317,426,345"/><area shape="rect" id="node11" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="504,109,624,137"/><area shape="rect" id="node17" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="518,213,610,241"/><area shape="rect" id="node21" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="516,265,612,293"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_icgraph.png" border="0" usemap="#bus_8c_a806cd6e423cc44a02552ed725d28ed7a_icgraph" alt=""/></div>
<map name="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_icgraph" id="bus_8c_a806cd6e423cc44a02552ed725d28ed7a_icgraph">
<area shape="rect" id="node3" href="ieee_8c.html#a4701558a7300ca20b3519287feb05bc1" title="listenloop" alt="" coords="157,5,235,33"/><area shape="rect" id="node5" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="283,5,445,33"/><area shape="rect" id="node7" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="494,5,544,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a68ec77741c71e9f01f346016e85f3e7b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int16_t cmd_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbus__t.html">bus_t</a> *&#160;</td>
          <td class="paramname"><em>bus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00132">132</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>References <a class="el" href="bus_8c_source.html#l00120">_cmd_callback()</a>, <a class="el" href="ieee_8c_source.html#l00050">bus</a>, <a class="el" href="bus_8h_source.html#l00078">bus_secaddr_adjust()</a>, <a class="el" href="channel_8c_source.html#l00250">channel_close()</a>, <a class="el" href="channel_8c_source.html#l00187">channel_preload()</a>, <a class="el" href="bus_8h_source.html#l00050">bus_t::cmd_done</a>, <a class="el" href="bus_8h_source.html#l00055">bus_t::command</a>, <a class="el" href="cmd_8h_source.html#l00077">cmd_t::command_buffer</a>, <a class="el" href="cmd_8c_source.html#l00118">command_execute()</a>, <a class="el" href="cmd_8h_source.html#l00075">cmd_t::command_length</a>, <a class="el" href="bus_8h_source.html#l00040">bus_t::current_device_address</a>, <a class="el" href="debug_8h_source.html#l00045">debug_printf</a>, <a class="el" href="rtconfig_8h_source.html#l00035">rtconfig_t::device_address</a>, <a class="el" href="bus_8h_source.html#l00051">bus_t::errnum</a>, <a class="el" href="errors_8h_source.html#l00069">ERROR_DRIVE_NOT_READY</a>, <a class="el" href="bus_8h_source.html#l00052">bus_t::errparam</a>, <a class="el" href="file_8c_source.html#l00069">file_open()</a>, <a class="el" href="bus_8h_source.html#l00059">bus_t::rtconf</a>, <a class="el" href="bus_8h_source.html#l00047">bus_t::secondary</a>, <a class="el" href="serial_8c_source.html#l00453">serial_delay()</a>, <a class="el" href="errormsg_8h_source.html#l00052">set_error()</a>, and <a class="el" href="errormsg_8c_source.html#l00128">set_error_ts()</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00359">bus_attention()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    int16_t st = 0;</div>
<div class="line"></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#a6c90e63602903c46ce77f9a51c387135">cmd_done</a> = 0;</div>
<div class="line">   </div>
<div class="line">    uint8_t secaddr = bus-&gt;<a class="code" href="structbus__t.html#a25538708e408bbc21b380cb6f709f5d8">secondary</a> &amp; 0x0f;</div>
<div class="line"></div>
<div class="line">    int8_t rv = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// prepare for callback from interrupt</span></div>
<div class="line">    <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a> = <a class="code" href="ieee_8c.html#ad75cc85b4588ff490a11c08232d0fc96">bus</a>;</div>
<div class="line">    <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#a6c90e63602903c46ce77f9a51c387135">cmd_done</a> = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// zero termination</span></div>
<div class="line">    bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a34c46fd8deb58b66521af86b4d3d4fd9">command_buffer</a>[bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a5ce40446fcd0f4c16af5ea0f16ff7adb">command_length</a>++] = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (secaddr == 0x0f) {</div>
<div class="line">            <span class="comment">/* Handle commands */</span></div>
<div class="line">        <span class="comment">// zero termination</span></div>
<div class="line">            rv = <a class="code" href="cmd_8c.html#abaf24aaeaa145dec95026ae71251be71">command_execute</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr), bus, &amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="bus_8c.html#a66ba5b15cb16106a8060999ab65de737">_cmd_callback</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// change device address after command</span></div>
<div class="line">        <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#ab5db802f5a6a738b104e6166a471d600">current_device_address</a> = <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#ac294eee916103f1c1f9700b1d39e1f90">rtconf</a>.<a class="code" href="structrtconfig__t.html#a32f3251e41b58001b8b6a97df656caf0">device_address</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Handle filenames */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>            <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Open file secaddr=%02x, name=&#39;%s&#39;\n&quot;</span>,</div>
<div class="line">                secaddr, bus-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a34c46fd8deb58b66521af86b4d3d4fd9">command_buffer</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            rv = <a class="code" href="file_8c.html#a2dac9b9090b14532b84f96929c3cb2cc">file_open</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr), bus, &amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, </div>
<div class="line">                            <a class="code" href="bus_8c.html#a66ba5b15cb16106a8060999ab65de737">_cmd_callback</a>, secaddr == 1);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (rv &lt; 0) {</div>
<div class="line">        <span class="comment">// open ran into an error</span></div>
<div class="line">        <span class="comment">// -- errormsg should be already set, so nothing left to do here</span></div>
<div class="line">        <span class="comment">// TODO</span></div>
<div class="line">        <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Received direct error number on open: %d\n&quot;</span>, rv);</div>
<div class="line">            <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="errors_8h.html#a8033c616a948b43efc809ee3233d7629aa93d4f29ed671f857ef74597386f4c53">ERROR_DRIVE_NOT_READY</a>);</div>
<div class="line">        st = 2;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// as this code is not (yet?) prepared for async operation, we </span></div>
<div class="line">        <span class="comment">// need to wait here until the response from the server comes</span></div>
<div class="line">        <span class="comment">// Note: use bus_for_irq here, as it is volatile</span></div>
<div class="line">        <span class="keywordflow">while</span> (<a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#a6c90e63602903c46ce77f9a51c387135">cmd_done</a> == 0) {</div>
<div class="line">            <span class="comment">// TODO this should be reworked more backend (serial) independent</span></div>
<div class="line">            <a class="code" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1">serial_delay</a>();</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#ifdef DEBUG_SERIAL</span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="debug_8h.html#a1995b1e018007e8176ca62be5ca5559d">debug_printf</a>(<span class="stringliteral">&quot;Received callback error number on open: %d\n&quot;</span>, <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">// result of the open</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a> == 1) {</div>
<div class="line">            <a class="code" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6">set_error_ts</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a>, <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#ac78a6fb6b51e958fe8d86aa630de39ef">errparam</a>, 0);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                    <a class="code" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907">set_error</a>(&amp;<a class="code" href="bus_8c.html#a208885b9d02f941e80cf70aaf666f46b">error</a>, <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// command may (or may not) open channel 15 for callback to the server</span></div>
<div class="line">        <span class="comment">// so close it here, as this is done separately</span></div>
<div class="line">        <span class="keywordflow">if</span> (secaddr == 15) {</div>
<div class="line">            <a class="code" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b">channel_close</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, 15));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#afcd2a477e3e22303b2bb28eeeb84f07e">errnum</a> != 0) {</div>
<div class="line">                    <a class="code" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b">channel_close</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr));</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">// really only does something on read-only channels</span></div>
<div class="line">                    <a class="code" href="channel_8c.html#a0e2a982477e7730e6d25854edd31a259">channel_preload</a>(<a class="code" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4">bus_secaddr_adjust</a>(bus, secaddr));</div>
<div class="line">        }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bus_8c.html#a567505b08ced37f3c29f8bd526703f84">bus_for_irq</a>-&gt;<a class="code" href="structbus__t.html#aa536b8970e01099010c0bbe033f95c07">command</a>.<a class="code" href="structcmd__t.html#a5ce40446fcd0f4c16af5ea0f16ff7adb">command_length</a> = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> st;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_cgraph.png" border="0" usemap="#bus_8c_a68ec77741c71e9f01f346016e85f3e7b_cgraph" alt=""/></div>
<map name="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_cgraph" id="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_cgraph">
<area shape="rect" id="node3" href="bus_8c.html#a66ba5b15cb16106a8060999ab65de737" title="_cmd_callback" alt="" coords="168,6,277,34"/><area shape="rect" id="node5" href="bus_8h.html#a95f026261f222ee259b8d615f8494ab4" title="bus_secaddr_adjust" alt="" coords="152,58,293,86"/><area shape="rect" id="node7" href="channel_8c.html#a27276c04c9964ae01dc04f436f57115b" title="channel_close" alt="" coords="547,539,653,567"/><area shape="rect" id="node13" href="delay_8h.html#a2a467023822de9459179b4c9a13da0d1" title="serial_delay" alt="" coords="1576,390,1669,418"/><area shape="rect" id="node28" href="channel_8c.html#a0e2a982477e7730e6d25854edd31a259" title="channel_preload" alt="" coords="163,369,283,397"/><area shape="rect" id="node44" href="cmd_8c.html#abaf24aaeaa145dec95026ae71251be71" title="command_execute" alt="" coords="156,967,290,995"/><area shape="rect" id="node79" href="errormsg_8h.html#aaa86d4da98675a27e26141f19fadc907" title="set_error" alt="" coords="563,1318,637,1346"/><area shape="rect" id="node81" href="errormsg_8c.html#adaf0ba8d19c41eda11dbdeade76a43a6" title="set_error_ts" alt="" coords="750,1343,842,1371"/><area shape="rect" id="node122" href="file_8c.html#a2dac9b9090b14532b84f96929c3cb2cc" title="file_open" alt="" coords="185,747,260,775"/><area shape="rect" id="node9" href="channel_8c.html#a4f422b28ba066eb1f918ffe5b31955df" title="channel_find" alt="" coords="930,442,1027,470"/><area shape="rect" id="node11" href="delay_8h.html#a304927311300df9e48c410ac5732d173" title="delayms" alt="" coords="1419,390,1490,418"/><area shape="rect" id="node15" href="packet_8h.html#a89d861cedccb4c116bca4686f5300b03" title="packet_get_contentlen" alt="" coords="718,546,874,574"/><area shape="rect" id="node17" href="packet_8h.html#a437f19cbea67d2fcceab3daca7999b53" title="packet_set_filled" alt="" coords="1394,751,1515,779"/><area shape="rect" id="node21" href="channel_8c.html#aa864b0a122d5e1fffd0035ba0778b4ba" title="_push_callback" alt="" coords="739,494,853,522"/><area shape="rect" id="node24" href="channel_8c.html#a7e98d9edd07cfa978bedfa82abf9953e" title="channel_close_int" alt="" coords="732,650,860,678"/><area shape="rect" id="node19" href="packet_8h.html#ac734d1711836633dfd94a48850b3a7a8" title="packet_set_read" alt="" coords="1563,751,1683,779"/><area shape="rect" id="node26" href="packet_8h.html#a2bd7a0617b2976ef62464f7e3cbcaada" title="packet_init" alt="" coords="936,726,1021,754"/><area shape="rect" id="node31" href="channel_8c.html#ae7784dd177e78324ea066e9a2e475737" title="channel_preload_int" alt="" coords="341,265,483,293"/><area shape="rect" id="node33" href="channel_8c.html#ad83a55f9935cdd471dc212f4ec6c7a6d" title="channel_pull" alt="" coords="552,317,648,345"/><area shape="rect" id="node40" href="packet_8h.html#addb176aaaeddd33017a9c51693dc4510" title="packet_has_data" alt="" coords="539,213,661,241"/><area shape="rect" id="node42" href="packet_8h.html#a23092de9747c65e9bbbe4516a23056a0" title="packet_is_last" alt="" coords="547,265,653,293"/><area shape="rect" id="node36" href="channel_8c.html#a26b97d3a3a80ba21ae3d74944fc3477e" title="_pull_callback" alt="" coords="743,289,849,317"/><area shape="rect" id="node46" href="name_8c.html#a0e25b9dc05d9d0c2b58510892dacd5eb" title="parse_filename" alt="" coords="356,747,468,775"/><area shape="rect" id="node50" href="cmd_8c.html#a638fac6ce8a134b11f8b5f8858af1e0a" title="command_to_name" alt="" coords="530,643,670,671"/><area shape="rect" id="node52" href="debug_8h.html#af964f239c289f93b082b6bb75f884fa2" title="debug_putcrlf" alt="" coords="549,799,651,827"/><area shape="rect" id="node73" href="debug_8h.html#a5b082d074ba501fcb65a5b280331405d" title="debug_putc" alt="" coords="933,957,1024,985"/><area shape="rect" id="node95" href="file_8c.html#a8336bd2f1ed40fc3520412402061d43b" title="file_submit_call" alt="" coords="356,967,468,995"/><area shape="rect" id="node117" href="provider_8c.html#a2fb3453f8017a7e05b4b0a0a1f7e9203" title="provider_assign" alt="" coords="354,1046,470,1074"/><area shape="rect" id="node120" href="rtconfig_8c.html#a213b60e4a3e31791a44d45ff8e867905" title="rtconfig_set" alt="" coords="367,1215,457,1243"/><area shape="rect" id="node48" href="cmd_8c.html#ab9643f90107f881d6ccbdcc75f2af424" title="command_find" alt="" coords="546,695,654,723"/><area shape="rect" id="node54" href="term_8c.html#ab6dcca8982478b8e68429b51f690b568" title="term_putcrlf" alt="" coords="933,1009,1025,1037"/><area shape="rect" id="node67" href="term_8c.html#ae337008fc505247280226b35d89757d0" title="term_flush" alt="" coords="1084,905,1167,933"/><area shape="rect" id="node56" href="term_8c.html#ab38e92632b4de8af92283e500910a510" title="term_putc" alt="" coords="1085,957,1166,985"/><area shape="rect" id="node63" href="term_8c.html#ad6b6b9297aa30da49f6dc3422bf708a4" title="send" alt="" coords="1256,930,1306,958"/><area shape="rect" id="node58" href="packet_8h.html#a2cade8ffc72b19e08f8fbff1ce795417" title="packet_wait_done" alt="" coords="1217,494,1346,522"/><area shape="rect" id="node60" href="packet_8h.html#ae18177b6d0283a274422f843fb924d81" title="packet_is_done" alt="" coords="1397,494,1512,522"/><area shape="rect" id="node70" href="serial_8c.html#a94547a891c369354cec16547930de449" title="serial_flush" alt="" coords="1237,442,1326,470"/><area shape="rect" id="node83" href="errormsg_8c.html#a6ebcffc1657e5c42336a72e11530b521" title="appendnumber" alt="" coords="923,1395,1034,1423"/><area shape="rect" id="node85" href="errormsg_8c.html#ae1d0465c57eaf7cdf2fb6491882a2e03" title="appendmsg" alt="" coords="933,1291,1024,1319"/><area shape="rect" id="node87" href="ledhw_8c.html#a85fc34f47b1f802300ac61f441ca4ec8" title="led_set" alt="" coords="947,1343,1011,1371"/><area shape="rect" id="node89" href="ledhw_8c.html#a07349daa417c8b171f2342486b71a3c6" title="_led_off" alt="" coords="1091,1291,1160,1319"/><area shape="rect" id="node91" href="ledhw_8c.html#a07f0d32d7cef684f1c3a1a17dede9eca" title="_led_on" alt="" coords="1091,1343,1160,1371"/><area shape="rect" id="node93" href="ledhw_8c.html#a38dc2f2205582632c983a345458f3bf2" title="init_prg" alt="" coords="1093,1395,1158,1423"/><area shape="rect" id="node97" href="provider_8c.html#ab1d09b1d2054aca48a208914b24a5844" title="provider_lookup" alt="" coords="542,1214,658,1242"/><area shape="rect" id="node106" href="channel_8c.html#a9e50fcfde4df544d0129c1b56a7a6359" title="channel_open" alt="" coords="547,1110,653,1138"/><area shape="rect" id="node110" href="debug_8h.html#a5a19c73a805a191cb89658d3a3fc308f" title="debug_puthex" alt="" coords="547,1058,653,1086"/><area shape="rect" id="node115" href="file_8c.html#ab5706f892355991d509f217c579c0ee4" title="_file_open_callback" alt="" coords="531,954,669,982"/><area shape="rect" id="node108" href="packet_8h.html#ad61c5a329d6379bd96faf0a29b1b565f" title="packet_reset" alt="" coords="747,1110,845,1138"/><area shape="rect" id="node112" href="debug_8h.html#a5dd69e91857c89f722568ab6eb8b95da" title="debug_putnib" alt="" coords="745,1058,847,1086"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_icgraph.png" border="0" usemap="#bus_8c_a68ec77741c71e9f01f346016e85f3e7b_icgraph" alt=""/></div>
<map name="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_icgraph" id="bus_8c_a68ec77741c71e9f01f346016e85f3e7b_icgraph">
<area shape="rect" id="node3" href="bus_8h.html#ac5b8727fd6b9e6bdaf98977f90832dcc" title="bus_attention" alt="" coords="152,5,253,33"/><area shape="rect" id="node5" href="ieee_8h.html#a47341f8a6f71378581fb6a67ece35ed2" title="ieee_mainloop_iteration" alt="" coords="301,5,464,33"/><area shape="rect" id="node7" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="main" alt="" coords="512,5,562,33"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a567505b08ced37f3c29f8bd526703f84"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="structbus__t.html">bus_t</a>* bus_for_irq</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00118">118</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a208885b9d02f941e80cf70aaf666f46b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structerrormsg__t.html">errormsg_t</a> error</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00080">80</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4a5291db8a22e45b52ff38feb3bc731f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t secaddr_offset_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bus_8c_source.html#l00085">85</a> of file <a class="el" href="bus_8c_source.html">bus.c</a>.</p>

<p>Referenced by <a class="el" href="bus_8c_source.html#l00087">bus_init()</a>, and <a class="el" href="bus_8c_source.html#l00094">bus_init_bus()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 4 2012 04:34:51 for XD2031 firmware by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
