<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>XD2031 pcserver: dir.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">XD2031 pcserver
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dir.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;dirent.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;strings.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="dir_8h_source.html">dir.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="name_8h_source.html">name.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fscmd_8h_source.html">fscmd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="wireformat_8h_source.html">wireformat.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dir.c:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c__incl.png" border="0" usemap="#dir_8c" alt=""/></div>
<map name="dir_8c" id="dir_8c">
<area shape="rect" id="node21" href="dir_8h.html" title="dir.h" alt="" coords="837,83,883,111"/><area shape="rect" id="node23" href="name_8h.html" title="name.h" alt="" coords="907,83,972,111"/><area shape="rect" id="node25" href="fscmd_8h.html" title="fscmd.h" alt="" coords="997,83,1064,111"/><area shape="rect" id="node27" href="wireformat_8h.html" title="wireformat.h" alt="" coords="1089,83,1183,111"/><area shape="rect" id="node31" href="log_8h.html" title="log.h" alt="" coords="1207,83,1256,111"/><area shape="rect" id="node29" href="errors_8h.html" title="errors.h" alt="" coords="1102,161,1169,189"/></map>
</div>
</div>
<p><a href="dir_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ac6afabdc09a49a433ee19d8a9486056d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(a, b)&#160;&#160;&#160;(((a)&lt;(b))?(a):(b))</td></tr>
<tr class="separator:ac6afabdc09a49a433ee19d8a9486056d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aef81eb27e34309ac735d320552007533"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#aef81eb27e34309ac735d320552007533">open_first_match</a> (const char *dir, const char *pattern, const char *options)</td></tr>
<tr class="separator:aef81eb27e34309ac735d320552007533"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8badd483a529f1e964bf1b112f4f2c7d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#a8badd483a529f1e964bf1b112f4f2c7d">dir_call_matches</a> (const char *dir, const char *pattern, int(*callback)(const int num_of_match, const char *name))</td></tr>
<tr class="separator:a8badd483a529f1e964bf1b112f4f2c7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8aa61243f4f8bb78f26ba95629fb64a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#a8aa61243f4f8bb78f26ba95629fb64a4">dir_fill_header</a> (char *dest, int driveno, char *dirpattern)</td></tr>
<tr class="separator:a8aa61243f4f8bb78f26ba95629fb64a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0949f89097f70de1469ba35e6b38ff53"><td class="memItemLeft" align="right" valign="top">struct dirent *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#a0949f89097f70de1469ba35e6b38ff53">dir_next</a> (DIR *dp, char *dirpattern)</td></tr>
<tr class="separator:a0949f89097f70de1469ba35e6b38ff53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b46e0fa997e8a6cec9a10594a5e6e0c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#a3b46e0fa997e8a6cec9a10594a5e6e0c">dir_fill_entry</a> (char *dest, char *curpath, struct dirent *de, int maxsize)</td></tr>
<tr class="separator:a3b46e0fa997e8a6cec9a10594a5e6e0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af218f0b4d3bb5da7a2ea755e080d73ea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#af218f0b4d3bb5da7a2ea755e080d73ea">dir_fill_disk</a> (char *dest)</td></tr>
<tr class="separator:af218f0b4d3bb5da7a2ea755e080d73ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a125151e3969662e6984e7c1202d6657d"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d">malloc_path</a> (const char *base, const char *name)</td></tr>
<tr class="separator:a125151e3969662e6984e7c1202d6657d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ac6afabdc09a49a433ee19d8a9486056d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define min</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((a)&lt;(b))?(a):(b))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dir_8c_source.html#l00043">43</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>Referenced by <a class="el" href="dir_8c_source.html#l00203">dir_fill_entry()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a8badd483a529f1e964bf1b112f4f2c7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_call_matches </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(const int num_of_match, const char *name)&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>calls the callback on every matching file, returning the number of matches The callback gets the match count as first parameter (starting with one), and if it returns != 0 then the loop is exited. </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00103">103</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="name_8c_source.html#l00043">compare_pattern()</a>, and <a class="el" href="dir_8c_source.html#l00259">malloc_path()</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00449">fs_delete()</a>.</p>
<div class="fragment"><div class="line">                                                                                                                      {</div>
<div class="line">    <span class="keywordtype">int</span> matches = 0;</div>
<div class="line">    DIR *dp;</div>
<div class="line">    <span class="keywordtype">int</span> rv;</div>
<div class="line">    <span class="keyword">struct </span>dirent *de;</div>
<div class="line">    <span class="keywordtype">int</span> onlyone = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// shortcut - if we don&#39;t have wildcards, just open it</span></div>
<div class="line">    <span class="keywordflow">if</span> (index(pattern, <span class="charliteral">&#39;*&#39;</span>) == NULL &amp;&amp; index(pattern, <span class="charliteral">&#39;?&#39;</span>) == NULL) {</div>
<div class="line">        onlyone = 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    dp = opendir(dir);</div>
<div class="line">    <span class="keywordflow">if</span> (dp) {</div>
<div class="line">        de = readdir(dp);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span> (de != NULL) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95">compare_pattern</a>(de-&gt;d_name, pattern)) {</div>
<div class="line">                <span class="comment">// match</span></div>
<div class="line">                matches ++;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// get full path</span></div>
<div class="line">                <span class="keywordtype">char</span> *namebuf = <a class="code" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d">malloc_path</a>(dir, de-&gt;d_name);</div>
<div class="line">                rv = callback(matches, namebuf);</div>
<div class="line">                <span class="comment">// free memory</span></div>
<div class="line">                free(namebuf);</div>
<div class="line">                <span class="keywordflow">if</span> (rv || onlyone) {</div>
<div class="line">                    <span class="comment">// either callback tells us to stop</span></div>
<div class="line">                    <span class="comment">// or there are no wildcards, so this has to be it</span></div>
<div class="line">                    closedir(dp);</div>
<div class="line">                    <span class="comment">// if rv &lt; 0 then some kind of error happened, return it</span></div>
<div class="line">                    <span class="comment">// instead of the number of matches</span></div>
<div class="line">                    <span class="keywordflow">return</span> (rv &lt; 0) ? rv : matches;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            de = readdir(dp);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">    closedir(dp);</div>
<div class="line">    <span class="keywordflow">return</span> matches;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_cgraph.png" border="0" usemap="#dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_cgraph" alt=""/></div>
<map name="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_cgraph" id="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_cgraph">
<area shape="rect" id="node3" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95" title="compare_pattern" alt="" coords="176,5,298,33"/><area shape="rect" id="node5" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d" title="malloc_path" alt="" coords="191,57,284,85"/><area shape="rect" id="node7" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd" title="log_info" alt="" coords="347,57,415,85"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_icgraph.png" border="0" usemap="#dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_icgraph" alt=""/></div>
<map name="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_icgraph" id="dir_8c_a8badd483a529f1e964bf1b112f4f2c7d_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a3efaddda31e5d537a7f19117af7eecb0" title="fs_delete" alt="" coords="177,5,252,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af218f0b4d3bb5da7a2ea755e080d73ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_fill_disk </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fill in the buffer with the final disk info entry </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00245">245</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="wireformat_8h_source.html#l00079">FS_DIR_LEN</a>, <a class="el" href="wireformat_8h_source.html#l00093">FS_DIR_MOD_FRE</a>, <a class="el" href="wireformat_8h_source.html#l00086">FS_DIR_MODE</a>, and <a class="el" href="wireformat_8h_source.html#l00087">FS_DIR_NAME</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00334">read_dir()</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>] = 1;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+1] = 0;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+2] = 0;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+3] = 0;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#a602d876bb8d21ac23806fec992e3364c">FS_DIR_MODE</a>]  = <a class="code" href="wireformat_8h.html#ae4662b081c94b7b421c436f15f33fad0">FS_DIR_MOD_FRE</a>;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>] = 0;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a> + 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_af218f0b4d3bb5da7a2ea755e080d73ea_icgraph.png" border="0" usemap="#dir_8c_af218f0b4d3bb5da7a2ea755e080d73ea_icgraph" alt=""/></div>
<map name="dir_8c_af218f0b4d3bb5da7a2ea755e080d73ea_icgraph" id="dir_8c_af218f0b4d3bb5da7a2ea755e080d73ea_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a0122ebf41799d0be0c82dba39a294293" title="read_dir" alt="" coords="142,5,212,33"/><area shape="rect" id="node5" href="fs__provider_8c.html#a17cc6c2c5a602a894044e1252373b0a0" title="readfile" alt="" coords="262,5,327,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3b46e0fa997e8a6cec9a10594a5e6e0c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_fill_entry </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>curpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dirent *&#160;</td>
          <td class="paramname"><em>de</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fill in the buffer with a directory entry </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00203">203</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="wireformat_8h_source.html#l00082">FS_DIR_DAY</a>, <a class="el" href="wireformat_8h_source.html#l00083">FS_DIR_HOUR</a>, <a class="el" href="wireformat_8h_source.html#l00079">FS_DIR_LEN</a>, <a class="el" href="wireformat_8h_source.html#l00084">FS_DIR_MIN</a>, <a class="el" href="wireformat_8h_source.html#l00094">FS_DIR_MOD_DIR</a>, <a class="el" href="wireformat_8h_source.html#l00091">FS_DIR_MOD_FIL</a>, <a class="el" href="wireformat_8h_source.html#l00086">FS_DIR_MODE</a>, <a class="el" href="wireformat_8h_source.html#l00081">FS_DIR_MONTH</a>, <a class="el" href="wireformat_8h_source.html#l00087">FS_DIR_NAME</a>, <a class="el" href="wireformat_8h_source.html#l00085">FS_DIR_SEC</a>, <a class="el" href="wireformat_8h_source.html#l00080">FS_DIR_YEAR</a>, <a class="el" href="log_8c_source.html#l00058">log_errno()</a>, <a class="el" href="log_8c_source.html#l00079">log_error()</a>, <a class="el" href="dir_8c_source.html#l00259">malloc_path()</a>, and <a class="el" href="dir_8c_source.html#l00043">min</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00334">read_dir()</a>.</p>
<div class="fragment"><div class="line">                                                                              {</div>
<div class="line">    <span class="keyword">struct </span>stat sbuf;</div>
<div class="line">    <span class="keyword">struct </span>tm *tp;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span> *realname = <a class="code" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d">malloc_path</a>(curpath, de-&gt;d_name);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* TODO: check return value */</span></div>
<div class="line">    <span class="keywordtype">int</span> rv = stat(realname, &amp;sbuf);</div>
<div class="line">    <span class="keywordflow">if</span> (rv &lt; 0) {</div>
<div class="line">        <a class="code" href="log_8c.html#a2a4f55619b06be2dc2f756d17ffbebb8">log_error</a>(<span class="stringliteral">&quot;Failed stat&#39;ing entry %s\n&quot;</span>, de-&gt;d_name);</div>
<div class="line">        <a class="code" href="log_8c.html#a4500b79e646dcead32849b2fdae4ffd1">log_errno</a>(<span class="stringliteral">&quot;Problem stat&#39;ing dir entry&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    free(realname);</div>
<div class="line"></div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>] = sbuf.st_size &amp; 255;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+1] = (sbuf.st_size &gt;&gt; 8) &amp; 255;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+2] = (sbuf.st_size &gt;&gt; 16) &amp; 255;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+3] = (sbuf.st_size &gt;&gt; 24) &amp; 255;</div>
<div class="line"></div>
<div class="line">        tp = localtime(&amp;sbuf.st_mtime);</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aae166503a1738d4c584dd5b29d92dc69">FS_DIR_YEAR</a>]  = tp-&gt;tm_year;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#abacbee63300fa50ce4f7e7300a1fe615">FS_DIR_MONTH</a>] = tp-&gt;tm_mon;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#af0c80e88b002b8b29c9bd4b4dcd44a55">FS_DIR_DAY</a>]   = tp-&gt;tm_mday;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aecccbb08084d899e6f7c76ac8c62cbc9">FS_DIR_HOUR</a>]  = tp-&gt;tm_hour;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#ac38750c3fecb16afb97c7f4dc83b75e1">FS_DIR_MIN</a>]   = tp-&gt;tm_min;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#a519f25c0ca42e53114df2be091984654">FS_DIR_SEC</a>]   = tp-&gt;tm_sec;</div>
<div class="line"></div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#a602d876bb8d21ac23806fec992e3364c">FS_DIR_MODE</a>]  = S_ISDIR(sbuf.st_mode) ? <a class="code" href="wireformat_8h.html#a254ee0365c0b27ae03d090d36e095040">FS_DIR_MOD_DIR</a> : <a class="code" href="wireformat_8h.html#aaffb46db0287f13c8fe481f2694e48e6">FS_DIR_MOD_FIL</a>;</div>
<div class="line">        <span class="comment">// de-&gt;d_name is 0-terminated (see readdir man page)</span></div>
<div class="line">        <span class="keywordtype">int</span> l = strlen(de-&gt;d_name);</div>
<div class="line">        strncpy(dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>, de-&gt;d_name,</div>
<div class="line">                  <a class="code" href="dir_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(l+1, maxsize-1-<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>));</div>
<div class="line">    <span class="comment">// make sure we&#39;re still null-terminated</span></div>
<div class="line">    dest[maxsize-1] = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a> + strlen(dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>) + 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_cgraph.png" border="0" usemap="#dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_cgraph" alt=""/></div>
<map name="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_cgraph" id="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_cgraph">
<area shape="rect" id="node3" href="log_8c.html#a4500b79e646dcead32849b2fdae4ffd1" title="log_errno" alt="" coords="154,5,232,33"/><area shape="rect" id="node5" href="log_8c.html#a2a4f55619b06be2dc2f756d17ffbebb8" title="log_error" alt="" coords="156,57,231,85"/><area shape="rect" id="node7" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d" title="malloc_path" alt="" coords="147,109,240,137"/><area shape="rect" id="node9" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd" title="log_info" alt="" coords="289,109,357,137"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_icgraph.png" border="0" usemap="#dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_icgraph" alt=""/></div>
<map name="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_icgraph" id="dir_8c_a3b46e0fa997e8a6cec9a10594a5e6e0c_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a0122ebf41799d0be0c82dba39a294293" title="read_dir" alt="" coords="148,5,218,33"/><area shape="rect" id="node5" href="fs__provider_8c.html#a17cc6c2c5a602a894044e1252373b0a0" title="readfile" alt="" coords="267,5,333,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8aa61243f4f8bb78f26ba95629fb64a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_fill_header </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>driveno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dirpattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fill the buffer with a header entry, using the driveno as line number and dirpattern as file name</p>
<p>returns the length of the buffer </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00155">155</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="wireformat_8h_source.html#l00079">FS_DIR_LEN</a>, <a class="el" href="wireformat_8h_source.html#l00092">FS_DIR_MOD_NAM</a>, <a class="el" href="wireformat_8h_source.html#l00086">FS_DIR_MODE</a>, and <a class="el" href="wireformat_8h_source.html#l00087">FS_DIR_NAME</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00334">read_dir()</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+0] = driveno &amp; 255;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+1] = 0;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+2] = 0;</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#aa748e7e2b430cda9da605d727fe804c3">FS_DIR_LEN</a>+3] = 0;</div>
<div class="line">        <span class="comment">// don&#39;t set date for now</span></div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#a602d876bb8d21ac23806fec992e3364c">FS_DIR_MODE</a>]  = <a class="code" href="wireformat_8h.html#a0d6dc2641ccc888a7aa3b8b8a2877841">FS_DIR_MOD_NAM</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (*dirpattern == 0) {</div>
<div class="line">        <span class="comment">// no pattern given</span></div>
<div class="line">            <span class="comment">// simple default</span></div>
<div class="line">            strncpy(dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>, <span class="stringliteral">&quot;.               &quot;</span>, 16);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        strncpy(dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>, dirpattern, 16);</div>
<div class="line">        <span class="keywordtype">int</span> l = strlen(dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>);</div>
<div class="line">        <span class="comment">// fill up with spaces</span></div>
<div class="line">        <span class="keywordflow">while</span> (l &lt; 16) (dest+<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a>)[l++] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">    }</div>
<div class="line">        dest[<a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a> + 16] = 0;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="wireformat_8h.html#af594f026264ffac3b48c9cc60c62bb70">FS_DIR_NAME</a> + 17;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a8aa61243f4f8bb78f26ba95629fb64a4_icgraph.png" border="0" usemap="#dir_8c_a8aa61243f4f8bb78f26ba95629fb64a4_icgraph" alt=""/></div>
<map name="dir_8c_a8aa61243f4f8bb78f26ba95629fb64a4_icgraph" id="dir_8c_a8aa61243f4f8bb78f26ba95629fb64a4_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a0122ebf41799d0be0c82dba39a294293" title="read_dir" alt="" coords="161,5,231,33"/><area shape="rect" id="node5" href="fs__provider_8c.html#a17cc6c2c5a602a894044e1252373b0a0" title="readfile" alt="" coords="281,5,346,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0949f89097f70de1469ba35e6b38ff53"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct dirent* dir_next </td>
          <td>(</td>
          <td class="paramtype">DIR *&#160;</td>
          <td class="paramname"><em>dp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dirpattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>finds the next directory entry matching the given directory pattern </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00180">180</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="name_8c_source.html#l00043">compare_pattern()</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00334">read_dir()</a>.</p>
<div class="fragment"><div class="line">                                                   {</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>dirent *de = NULL;</div>
<div class="line"></div>
<div class="line">    de = readdir(dp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (dirpattern != NULL &amp;&amp; *dirpattern != 0) {</div>
<div class="line">        <span class="keywordflow">while</span> (de != NULL) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95">compare_pattern</a>(de-&gt;d_name, dirpattern)) {</div>
<div class="line">                <span class="comment">// match</span></div>
<div class="line">                <span class="keywordflow">return</span> de;</div>
<div class="line">            }</div>
<div class="line">            de = readdir(dp);</div>
<div class="line">        }       </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> de;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a0949f89097f70de1469ba35e6b38ff53_cgraph.png" border="0" usemap="#dir_8c_a0949f89097f70de1469ba35e6b38ff53_cgraph" alt=""/></div>
<map name="dir_8c_a0949f89097f70de1469ba35e6b38ff53_cgraph" id="dir_8c_a0949f89097f70de1469ba35e6b38ff53_cgraph">
<area shape="rect" id="node3" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95" title="compare_pattern" alt="" coords="123,5,245,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a0949f89097f70de1469ba35e6b38ff53_icgraph.png" border="0" usemap="#dir_8c_a0949f89097f70de1469ba35e6b38ff53_icgraph" alt=""/></div>
<map name="dir_8c_a0949f89097f70de1469ba35e6b38ff53_icgraph" id="dir_8c_a0949f89097f70de1469ba35e6b38ff53_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a0122ebf41799d0be0c82dba39a294293" title="read_dir" alt="" coords="124,5,194,33"/><area shape="rect" id="node5" href="fs__provider_8c.html#a17cc6c2c5a602a894044e1252373b0a0" title="readfile" alt="" coords="243,5,309,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a125151e3969662e6984e7c1202d6657d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* malloc_path </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>malloc a new path and copy the given base path and name, concatenating them with the path separator </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00259">259</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00087">log_info()</a>.</p>

<p>Referenced by <a class="el" href="dir_8c_source.html#l00103">dir_call_matches()</a>, <a class="el" href="dir_8c_source.html#l00203">dir_fill_entry()</a>, <a class="el" href="fs__provider_8c_source.html#l00540">fs_cd()</a>, <a class="el" href="fs__provider_8c_source.html#l00576">fs_mkdir()</a>, <a class="el" href="fs__provider_8c_source.html#l00479">fs_rename()</a>, <a class="el" href="fs__provider_8c_source.html#l00606">fs_rmdir()</a>, <a class="el" href="fs__provider_8c_source.html#l00128">fsp_new()</a>, and <a class="el" href="dir_8c_source.html#l00049">open_first_match()</a>.</p>
<div class="fragment"><div class="line">                                                      {</div>
<div class="line">        <span class="keywordtype">int</span> l = (base == NULL) ? 0 : strlen(base);</div>
<div class="line">        l += (name == NULL) ? 0 : strlen(name);</div>
<div class="line">        l += 3; <span class="comment">// dir separator, terminating zero, optional &quot;.&quot;</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">char</span> *dirpath = malloc(l);</div>
<div class="line">        dirpath[0] = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (base != NULL) {</div>
<div class="line">                strcat(dirpath, base);</div>
<div class="line">                strcat(dirpath, <span class="stringliteral">&quot;/&quot;</span>);   <span class="comment">// TODO dir separator char</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (name != NULL) {</div>
<div class="line">                strcat(dirpath, name);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd">log_info</a>(<span class="stringliteral">&quot;Calculate new dir path: %s\n&quot;</span>, dirpath);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> dirpath;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a125151e3969662e6984e7c1202d6657d_cgraph.png" border="0" usemap="#dir_8c_a125151e3969662e6984e7c1202d6657d_cgraph" alt=""/></div>
<map name="dir_8c_a125151e3969662e6984e7c1202d6657d_cgraph" id="dir_8c_a125151e3969662e6984e7c1202d6657d_cgraph">
<area shape="rect" id="node3" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd" title="log_info" alt="" coords="147,5,215,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_a125151e3969662e6984e7c1202d6657d_icgraph.png" border="0" usemap="#dir_8c_a125151e3969662e6984e7c1202d6657d_icgraph" alt=""/></div>
<map name="dir_8c_a125151e3969662e6984e7c1202d6657d_icgraph" id="dir_8c_a125151e3969662e6984e7c1202d6657d_icgraph">
<area shape="rect" id="node3" href="dir_8h.html#a8badd483a529f1e964bf1b112f4f2c7d" title="dir_call_matches" alt="" coords="149,5,270,33"/><area shape="rect" id="node7" href="dir_8h.html#a3b46e0fa997e8a6cec9a10594a5e6e0c" title="dir_fill_entry" alt="" coords="163,57,256,85"/><area shape="rect" id="node13" href="fs__provider_8c.html#a4cd03a4037dec872b22cd74b09963f90" title="fs_cd" alt="" coords="183,109,236,137"/><area shape="rect" id="node15" href="fs__provider_8c.html#a371a63758f12f2037b28dadf00faa395" title="fs_mkdir" alt="" coords="173,161,245,189"/><area shape="rect" id="node17" href="fs__provider_8c.html#a834a91f4d8d7230fd7a34c5c09e274d7" title="fs_rename" alt="" coords="167,213,251,241"/><area shape="rect" id="node19" href="fs__provider_8c.html#a5e22eb3d9de7f507deaa9a9b68c5069e" title="fs_rmdir" alt="" coords="175,265,244,293"/><area shape="rect" id="node21" href="fs__provider_8c.html#a51aa84fef84236572ee71e569883876d" title="fsp_new" alt="" coords="174,317,245,345"/><area shape="rect" id="node23" href="dir_8h.html#aef81eb27e34309ac735d320552007533" title="open_first_match" alt="" coords="148,369,271,397"/><area shape="rect" id="node5" href="fs__provider_8c.html#a3efaddda31e5d537a7f19117af7eecb0" title="fs_delete" alt="" coords="321,5,396,33"/><area shape="rect" id="node9" href="fs__provider_8c.html#a0122ebf41799d0be0c82dba39a294293" title="read_dir" alt="" coords="324,57,394,85"/><area shape="rect" id="node11" href="fs__provider_8c.html#a17cc6c2c5a602a894044e1252373b0a0" title="readfile" alt="" coords="462,57,527,85"/><area shape="rect" id="node25" href="fs__provider_8c.html#a2b9a4a4d739b3230e451c61dad1cd7b7" title="open_file" alt="" coords="321,369,396,397"/><area shape="rect" id="node27" href="fs__provider_8c.html#acffd902f4e85b06b1563b973f8108138" title="open_file_rd" alt="" coords="447,317,542,345"/><area shape="rect" id="node29" href="fs__provider_8c.html#a9da86b704388c7eef6bc5877dce054c8" title="open_file_wr" alt="" coords="446,369,543,397"/><area shape="rect" id="node31" href="fs__provider_8c.html#ad2117b274dbc7b04a8e02bf451c29bc9" title="open_file_ap" alt="" coords="446,421,544,449"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aef81eb27e34309ac735d320552007533"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* open_first_match </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fopen the first matching directory entry, using the given options string </p>

<p>Definition at line <a class="el" href="dir_8c_source.html#l00049">49</a> of file <a class="el" href="dir_8c_source.html">dir.c</a>.</p>

<p>References <a class="el" href="name_8c_source.html#l00043">compare_pattern()</a>, <a class="el" href="log_8c_source.html#l00058">log_errno()</a>, <a class="el" href="log_8c_source.html#l00087">log_info()</a>, and <a class="el" href="dir_8c_source.html#l00259">malloc_path()</a>.</p>

<p>Referenced by <a class="el" href="fs__provider_8c_source.html#l00262">open_file()</a>.</p>
<div class="fragment"><div class="line">                                                                                  {</div>
<div class="line">    DIR *dp;</div>
<div class="line">    FILE *fp;</div>
<div class="line">    <span class="keyword">struct </span>dirent *de;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// shortcut - if we don&#39;t have wildcards, just open it</span></div>
<div class="line">    <span class="keywordflow">if</span> (index(pattern, <span class="charliteral">&#39;*&#39;</span>) == NULL &amp;&amp; index(pattern, <span class="charliteral">&#39;?&#39;</span>) == NULL) {</div>
<div class="line">        <span class="keywordtype">char</span> *namebuf = <a class="code" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d">malloc_path</a>(dir, pattern);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd">log_info</a>(<span class="stringliteral">&quot;opening file with name %s\n&quot;</span>,namebuf);</div>
<div class="line"></div>
<div class="line">        fp = fopen(namebuf, options);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">            <a class="code" href="log_8c.html#a4500b79e646dcead32849b2fdae4ffd1">log_errno</a>(<span class="stringliteral">&quot;Error opening file with first match&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        free(namebuf);</div>
<div class="line">        <span class="keywordflow">return</span> fp;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    dp = opendir(dir);</div>
<div class="line">    <span class="keywordflow">if</span> (dp) {</div>
<div class="line">        de = readdir(dp);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span> (de != NULL) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95">compare_pattern</a>(de-&gt;d_name, pattern)) {</div>
<div class="line">                <span class="comment">// match</span></div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">char</span> *namebuf = <a class="code" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d">malloc_path</a>(dir, de-&gt;d_name);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd">log_info</a>(<span class="stringliteral">&quot;opening file with name %s\n&quot;</span>,namebuf);</div>
<div class="line"></div>
<div class="line">                fp = fopen(namebuf, options);</div>
<div class="line">                <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">                    <a class="code" href="log_8c.html#a4500b79e646dcead32849b2fdae4ffd1">log_errno</a>(<span class="stringliteral">&quot;Error opening file with match&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                free(namebuf);</div>
<div class="line">                closedir(dp);</div>
<div class="line">                <span class="keywordflow">return</span> fp;</div>
<div class="line">            }</div>
<div class="line">            de = readdir(dp);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_aef81eb27e34309ac735d320552007533_cgraph.png" border="0" usemap="#dir_8c_aef81eb27e34309ac735d320552007533_cgraph" alt=""/></div>
<map name="dir_8c_aef81eb27e34309ac735d320552007533_cgraph" id="dir_8c_aef81eb27e34309ac735d320552007533_cgraph">
<area shape="rect" id="node3" href="name_8c.html#a95fe960512bf2097c7c7980dbffddb95" title="compare_pattern" alt="" coords="179,5,301,33"/><area shape="rect" id="node5" href="log_8c.html#a4500b79e646dcead32849b2fdae4ffd1" title="log_errno" alt="" coords="201,57,279,85"/><area shape="rect" id="node7" href="log_8c.html#a71ea2d6ec56d5620e986340d060702cd" title="log_info" alt="" coords="350,135,418,163"/><area shape="rect" id="node9" href="dir_8c.html#a125151e3969662e6984e7c1202d6657d" title="malloc_path" alt="" coords="193,161,287,189"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dir_8c_aef81eb27e34309ac735d320552007533_icgraph.png" border="0" usemap="#dir_8c_aef81eb27e34309ac735d320552007533_icgraph" alt=""/></div>
<map name="dir_8c_aef81eb27e34309ac735d320552007533_icgraph" id="dir_8c_aef81eb27e34309ac735d320552007533_icgraph">
<area shape="rect" id="node3" href="fs__provider_8c.html#a2b9a4a4d739b3230e451c61dad1cd7b7" title="open_file" alt="" coords="180,57,255,85"/><area shape="rect" id="node5" href="fs__provider_8c.html#acffd902f4e85b06b1563b973f8108138" title="open_file_rd" alt="" coords="306,5,401,33"/><area shape="rect" id="node7" href="fs__provider_8c.html#a9da86b704388c7eef6bc5877dce054c8" title="open_file_wr" alt="" coords="305,57,402,85"/><area shape="rect" id="node9" href="fs__provider_8c.html#ad2117b274dbc7b04a8e02bf451c29bc9" title="open_file_ap" alt="" coords="304,109,402,137"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 4 2012 04:37:40 for XD2031 pcserver by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
